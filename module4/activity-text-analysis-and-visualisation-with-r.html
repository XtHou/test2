<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>5 Activity: Text analysis and visualisation with R | Module 4 Making sense of tabular data</title>
  <meta name="description" content="This is the fourth module in FIT5147 Data Exploration and Visualisation. In this module you will learn about how to explore and visualise textual data and data that is organised into networks or hierarchies.">
  <meta name="generator" content="bookdown  and GitBook 2.6.7">

  <meta property="og:title" content="5 Activity: Text analysis and visualisation with R | Module 4 Making sense of tabular data" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is the fourth module in FIT5147 Data Exploration and Visualisation. In this module you will learn about how to explore and visualise textual data and data that is organised into networks or hierarchies." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="5 Activity: Text analysis and visualisation with R | Module 4 Making sense of tabular data" />
  
  <meta name="twitter:description" content="This is the fourth module in FIT5147 Data Exploration and Visualisation. In this module you will learn about how to explore and visualise textual data and data that is organised into networks or hierarchies." />
  

<meta name="author" content="Kimbal Marriott">



  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="exploring-text-and-document-collections.html">
<link rel="next" href="activity-textual-exploration-with-voyant-tools.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />










<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><strong><a href="./">Module 4 Making sense of tabular data</a></strong></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Making sense of relational and textual data: Overview</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#aims-of-this-module"><i class="fa fa-check"></i>Aims of this module</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#how-to-study-for-this-module"><i class="fa fa-check"></i>How to study for this module</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="network-analysis-and-visualisation.html"><a href="network-analysis-and-visualisation.html"><i class="fa fa-check"></i><b>2</b> Network analysis and visualisation</a><ul>
<li class="chapter" data-level="2.1" data-path="network-analysis-and-visualisation.html"><a href="network-analysis-and-visualisation.html#some-terminology"><i class="fa fa-check"></i><b>2.1</b> Some terminology</a></li>
<li class="chapter" data-level="2.2" data-path="network-analysis-and-visualisation.html"><a href="network-analysis-and-visualisation.html#network-visualisation"><i class="fa fa-check"></i><b>2.2</b> Network visualisation</a></li>
<li class="chapter" data-level="2.3" data-path="network-analysis-and-visualisation.html"><a href="network-analysis-and-visualisation.html#network-analytics"><i class="fa fa-check"></i><b>2.3</b> Network analytics</a></li>
<li class="chapter" data-level="2.4" data-path="network-analysis-and-visualisation.html"><a href="network-analysis-and-visualisation.html#trees-and-hierarchies"><i class="fa fa-check"></i><b>2.4</b> Trees and hierarchies</a></li>
<li class="chapter" data-level="2.5" data-path="network-analysis-and-visualisation.html"><a href="network-analysis-and-visualisation.html#flow-diagrams"><i class="fa fa-check"></i><b>2.5</b> Flow diagrams</a></li>
<li class="chapter" data-level="2.6" data-path="network-analysis-and-visualisation.html"><a href="network-analysis-and-visualisation.html#set-visualisation"><i class="fa fa-check"></i><b>2.6</b> Set visualisation</a></li>
<li class="chapter" data-level="2.7" data-path="network-analysis-and-visualisation.html"><a href="network-analysis-and-visualisation.html#summary"><i class="fa fa-check"></i><b>2.7</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="activity-relational-data-analysis-and-visualisation-with-r.html"><a href="activity-relational-data-analysis-and-visualisation-with-r.html"><i class="fa fa-check"></i><b>3</b> Activity: Relational data analysis and visualisation with R</a><ul>
<li class="chapter" data-level="3.1" data-path="activity-relational-data-analysis-and-visualisation-with-r.html"><a href="activity-relational-data-analysis-and-visualisation-with-r.html#relationalnetwork-data-visualizations"><i class="fa fa-check"></i><b>3.1</b> Relational/network data &amp; visualizations</a></li>
<li class="chapter" data-level="" data-path="activity-relational-data-analysis-and-visualisation-with-r.html"><a href="activity-relational-data-analysis-and-visualisation-with-r.html#a.-basic-graphs"><i class="fa fa-check"></i>A. Basic graphs</a></li>
<li class="chapter" data-level="" data-path="activity-relational-data-analysis-and-visualisation-with-r.html"><a href="activity-relational-data-analysis-and-visualisation-with-r.html#b.-directed-graphs"><i class="fa fa-check"></i>B. Directed graphs</a></li>
<li class="chapter" data-level="" data-path="activity-relational-data-analysis-and-visualisation-with-r.html"><a href="activity-relational-data-analysis-and-visualisation-with-r.html#c.-analysis-of-network-data"><i class="fa fa-check"></i>C. Analysis of Network Data</a><ul>
<li class="chapter" data-level="" data-path="activity-relational-data-analysis-and-visualisation-with-r.html"><a href="activity-relational-data-analysis-and-visualisation-with-r.html#the-karate-club"><i class="fa fa-check"></i>The Karate club</a></li>
<li class="chapter" data-level="" data-path="activity-relational-data-analysis-and-visualisation-with-r.html"><a href="activity-relational-data-analysis-and-visualisation-with-r.html#centrality-1"><i class="fa fa-check"></i>Centrality</a></li>
<li class="chapter" data-level="" data-path="activity-relational-data-analysis-and-visualisation-with-r.html"><a href="activity-relational-data-analysis-and-visualisation-with-r.html#edge-centrality"><i class="fa fa-check"></i>Edge centrality</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="exploring-text-and-document-collections.html"><a href="exploring-text-and-document-collections.html"><i class="fa fa-check"></i><b>4</b> Exploring text and document collections</a><ul>
<li class="chapter" data-level="4.1" data-path="exploring-text-and-document-collections.html"><a href="exploring-text-and-document-collections.html#preprocessing"><i class="fa fa-check"></i><b>4.1</b> Preprocessing</a></li>
<li class="chapter" data-level="4.2" data-path="exploring-text-and-document-collections.html"><a href="exploring-text-and-document-collections.html#exploring-single-documents"><i class="fa fa-check"></i><b>4.2</b> Exploring single documents</a></li>
<li class="chapter" data-level="4.3" data-path="exploring-text-and-document-collections.html"><a href="exploring-text-and-document-collections.html#exploring-a-document-corpus"><i class="fa fa-check"></i><b>4.3</b> Exploring a document corpus</a></li>
<li class="chapter" data-level="4.4" data-path="exploring-text-and-document-collections.html"><a href="exploring-text-and-document-collections.html#explorative-interfaces"><i class="fa fa-check"></i><b>4.4</b> Explorative Interfaces</a></li>
<li class="chapter" data-level="4.5" data-path="exploring-text-and-document-collections.html"><a href="exploring-text-and-document-collections.html#text-analysis-tools"><i class="fa fa-check"></i><b>4.5</b> Text analysis tools</a></li>
<li class="chapter" data-level="4.6" data-path="exploring-text-and-document-collections.html"><a href="exploring-text-and-document-collections.html#conclusion"><i class="fa fa-check"></i><b>4.6</b> Conclusion</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="activity-text-analysis-and-visualisation-with-r.html"><a href="activity-text-analysis-and-visualisation-with-r.html"><i class="fa fa-check"></i><b>5</b> Activity: Text analysis and visualisation with R</a><ul>
<li class="chapter" data-level="5.1" data-path="activity-text-analysis-and-visualisation-with-r.html"><a href="activity-text-analysis-and-visualisation-with-r.html#text-analysis-and-visualisation-with-r"><i class="fa fa-check"></i><b>5.1</b> Text analysis and visualisation with R</a></li>
<li class="chapter" data-level="" data-path="activity-text-analysis-and-visualisation-with-r.html"><a href="activity-text-analysis-and-visualisation-with-r.html#lemmatizers"><i class="fa fa-check"></i>Lemmatizers</a></li>
<li class="chapter" data-level="5.2" data-path="activity-text-analysis-and-visualisation-with-r.html"><a href="activity-text-analysis-and-visualisation-with-r.html#text-networks"><i class="fa fa-check"></i><b>5.2</b> Text networks</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="activity-textual-exploration-with-voyant-tools.html"><a href="activity-textual-exploration-with-voyant-tools.html"><i class="fa fa-check"></i><b>6</b> Activity: Textual Exploration with Voyant Tools</a><ul>
<li class="chapter" data-level="6.1" data-path="activity-textual-exploration-with-voyant-tools.html"><a href="activity-textual-exploration-with-voyant-tools.html#what-is-voyant-tools"><i class="fa fa-check"></i><b>6.1</b> What is Voyant Tools?</a></li>
<li class="chapter" data-level="6.2" data-path="activity-textual-exploration-with-voyant-tools.html"><a href="activity-textual-exploration-with-voyant-tools.html#what-can-i-do-with-it"><i class="fa fa-check"></i><b>6.2</b> What can I do with it?</a></li>
<li class="chapter" data-level="6.3" data-path="activity-textual-exploration-with-voyant-tools.html"><a href="activity-textual-exploration-with-voyant-tools.html#how-do-i-start"><i class="fa fa-check"></i><b>6.3</b> How do I start?</a></li>
<li class="chapter" data-level="6.4" data-path="activity-textual-exploration-with-voyant-tools.html"><a href="activity-textual-exploration-with-voyant-tools.html#exercises"><i class="fa fa-check"></i><b>6.4</b> Exercises</a><ul>
<li class="chapter" data-level="6.4.1" data-path="activity-textual-exploration-with-voyant-tools.html"><a href="activity-textual-exploration-with-voyant-tools.html#exploring-a-corpus-of-documents"><i class="fa fa-check"></i><b>6.4.1</b> Exploring a corpus of documents</a></li>
<li class="chapter" data-level="6.4.2" data-path="activity-textual-exploration-with-voyant-tools.html"><a href="activity-textual-exploration-with-voyant-tools.html#exploring-a-single-text-document"><i class="fa fa-check"></i><b>6.4.2</b> Exploring a single text document</a></li>
<li class="chapter" data-level="6.4.3" data-path="activity-textual-exploration-with-voyant-tools.html"><a href="activity-textual-exploration-with-voyant-tools.html#optional-additional-exercises"><i class="fa fa-check"></i><b>6.4.3</b> (Optional) Additional Exercises</a></li>
</ul></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Module 4 Making sense of tabular data</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="activity-text-analysis-and-visualisation-with-r" class="section level1">
<h1><span class="header-section-number">5</span> Activity: Text analysis and visualisation with R</h1>
<div id="text-analysis-and-visualisation-with-r" class="section level2">
<h2><span class="header-section-number">5.1</span> Text analysis and visualisation with R</h2>
<p>Wordclouds are one way to visualise word collections e.g. a document (or collection of collections = corpus).</p>
<p>If your text is not clean &amp; tidy then you may have to transform or ‘clean’ it.</p>
<p>There are many transformations that can be made to raw text e.g.:</p>
<ul>
<li>Convert the text to lower case</li>
<li>Remove numbers</li>
<li>Remove common stopwords (e.g. ‘the’)</li>
<li>Remove your own stop words (e.g. for a specific topic)</li>
<li>Remove punctuation</li>
<li>Remove extra white space</li>
<li>Text stemming (common root words, not necessarily real words)</li>
<li>Lemmatisation (common dictionary root words)</li>
<li>Special characters e.g. replacing “/”, “@”</li>
<li>Really special characters like ü ö ä Ä Ü Ö (and those are just the umlauts)</li>
<li>Really, really special characters like unprintable whitespace, unicode, emoticons</li>
</ul>
<p>Based on: <a href="http://www.sthda.com/english/wiki/text-mining-and-word-cloud-fundamentals-in-r-5-simple-steps-you-should-know" class="uri">http://www.sthda.com/english/wiki/text-mining-and-word-cloud-fundamentals-in-r-5-simple-steps-you-should-know</a></p>
<p>Data file download: <a href="diagrams_datasets/section5/WordCloud.txt">WordCloud.txt</a></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># we need the following libraries</span>
<span class="kw">library</span>(<span class="st">&quot;tm&quot;</span>) <span class="co"># for text mining</span>
<span class="kw">library</span>(<span class="st">&quot;SnowballC&quot;</span>) <span class="co"># for text stemming</span>
<span class="kw">library</span>(<span class="st">&quot;wordcloud&quot;</span>)
<span class="kw">library</span>(<span class="st">&quot;RColorBrewer&quot;</span>)
 
<span class="co"># Read the text file</span>
filePath &lt;-<span class="st"> &quot;WordCloud.txt&quot;</span> <span class="co"># or get your own this is one of subject chapters</span>
text &lt;-<span class="kw">readLines</span>(filePath) <span class="co"># Load the data as a corpus and save a copy as &#39;input&#39;</span>
input &lt;-<span class="st"> </span><span class="kw">Corpus</span>(<span class="kw">VectorSource</span>(text))
docs &lt;-<span class="st"> </span>input</code></pre>
<p>You can ‘inspect(docs)’ but it’s messy. Just open the file “WordCloud.txt” to inspect.</p>
<p>Or look at the source (may have changed): <a href="https://www.alexandriarepository.org/reader/making-sense-of-relational-and-textual-data/76218" class="uri">https://www.alexandriarepository.org/reader/making-sense-of-relational-and-textual-data/76218</a></p>
<p><mark class="big"><strong>Do some processing</strong></mark></p>
<p>We want to isolate all the words, convert to a matrix, count them, sort them, dump them into a DataFrame
(for display and for wordclouds)</p>
<pre class="sourceCode r"><code class="sourceCode r">dtm &lt;-<span class="st"> </span><span class="kw">TermDocumentMatrix</span>(docs)
m &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(dtm)
v &lt;-<span class="st"> </span><span class="kw">sort</span>(
  <span class="kw">rowSums</span>(m),
  <span class="dt">decreasing =</span> <span class="ot">TRUE</span>
)
d &lt;-<span class="st"> </span><span class="kw">data.frame</span>(
  <span class="dt">words =</span> <span class="kw">names</span>(v),
  <span class="dt">freq =</span> v
)
<span class="kw">nrow</span>(d) <span class="co"># how many &#39;words&#39;</span>
<span class="kw">head</span>(d,<span class="dv">10</span>) <span class="co"># look at top 10</span></code></pre>
<p><mark class="big"><strong>How many ‘words’ are there?</strong></mark></p>
<p><mark class="big"><strong>Have a look at the tail too, not so pretty…</strong></mark></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">tail</span>(d ,<span class="dv">10</span>) 
<span class="co"># or look at all the words with</span>
<span class="co"># d$word</span>
<span class="co"># generate the raw word cloud, OK here because it&#39;s &#39;reasonably&#39; tidy text</span>
<span class="co"># up to you if you want to try this with e.g. tweetsset.seed(1234)</span>
<span class="co"># so that the cloud is reproducible, optional</span>
 
<span class="kw">wordcloud</span>(
  <span class="dt">words =</span> d<span class="op">$</span>words,
  <span class="dt">freq =</span> d<span class="op">$</span>freq,
  <span class="dt">min.freq =</span> <span class="dv">1</span>,
  <span class="dt">max.words =</span> <span class="dv">200</span>,
  <span class="dt">random.order =</span> <span class="ot">FALSE</span>,
  <span class="dt">rot.per =</span> <span class="fl">0.35</span>,
  <span class="dt">colors =</span> <span class="kw">brewer.pal</span>(<span class="dv">8</span>,<span class="st">&quot;Dark2&quot;</span>)
)</code></pre>
<p>Your turn, change the min.freq then the max.words and run a few times to test</p>
<p>What’s the difference between the two parameters?</p>
<p>We can see from the frequency table and the wordcloud, that ‘the’ is a winner.</p>
<p><strong>Do the common words (e.g. ‘the’) distort our analysis?</strong></p>
<p>These common words are referred to as ‘stop words’</p>
<p>So, before we remove them… who are these stopwords anyway?</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">stopwords</span>(<span class="st">&quot;english&quot;</span>)
<span class="kw">stopwords</span>(<span class="st">&quot;french&quot;</span>) <span class="co"># c&#39;est la vie...</span>
<span class="kw">stopwords</span>(<span class="st">&quot;romanian&quot;</span>) <span class="co"># why not...</span>
<span class="kw">stopwords</span>(<span class="st">&quot;swahili&quot;</span>) <span class="co"># no... boo</span>
 
docs &lt;-<span class="st"> </span><span class="kw">tm_map</span>(docs, tolower) <span class="co"># make all letters to lowercase</span>
docs &lt;-<span class="st"> </span><span class="kw">tm_map</span>(docs, removeWords, <span class="kw">stopwords</span>(<span class="st">&quot;english&quot;</span>)) 
<span class="co"># this is destructive, you may need to start again or use the copy &#39;input&#39;</span>
<span class="co"># and process again</span>
 
dtm &lt;-<span class="st"> </span><span class="kw">TermDocumentMatrix</span>(docs)
m &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(dtm)
v &lt;-<span class="st"> </span><span class="kw">sort</span>(<span class="kw">rowSums</span>(m),<span class="dt">decreasing=</span><span class="ot">TRUE</span>)
d &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">words =</span> <span class="kw">names</span>(v), <span class="dt">freq=</span>v)
<span class="kw">nrow</span>(d)
<span class="kw">head</span>(d, <span class="dv">10</span>)
 
<span class="co"># and display again, &#39;the&#39; should be gone</span>
<span class="kw">set.seed</span>(<span class="dv">1234</span>)
<span class="kw">wordcloud</span>(
  <span class="dt">words =</span> d<span class="op">$</span>words, <span class="dt">freq =</span> d<span class="op">$</span>freq, <span class="dt">min.freq =</span> <span class="dv">1</span>,
  <span class="dt">max.words=</span><span class="dv">200</span>, <span class="dt">random.order=</span><span class="ot">FALSE</span>, <span class="dt">rot.per=</span><span class="fl">0.35</span>, 
  <span class="dt">colors=</span><span class="kw">brewer.pal</span>(<span class="dv">8</span>, <span class="st">&quot;Dark2&quot;</span>)
)</code></pre>
<p>use <code>?TermDocumentMatrix</code> to have a look at the data you used.</p>
<p>Notice above ‘word’ and ‘words’ (‘document’ &amp; ‘documents’ etc.)…. how to fix that?</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">stemCompletion</span>(<span class="kw">c</span>(<span class="st">&quot;visualis&quot;</span>,<span class="st">&quot;techniqu&quot;</span>,<span class="st">&quot;identifi&quot;</span>), d<span class="op">$</span>words) 
<span class="kw">stemCompletion</span>(<span class="kw">c</span>(<span class="st">&quot;visualis&quot;</span>,<span class="st">&quot;techniqu&quot;</span>,<span class="st">&quot;identifi&quot;</span>), d<span class="op">$</span>words, <span class="dt">type =</span> <span class="st">&quot;prevalent&quot;</span>) 
<span class="kw">stemCompletion</span>(<span class="kw">c</span>(<span class="st">&quot;visualis&quot;</span>,<span class="st">&quot;techniqu&quot;</span>,<span class="st">&quot;identifi&quot;</span>), d<span class="op">$</span>words, <span class="dt">type =</span> <span class="st">&quot;random&quot;</span>)</code></pre>
<p>Also try to run the above code a few times to see what happens.</p>
<p>This is called <strong>stemming</strong>, which is finding the word stem of an input.</p>
<p>Is stemming reversible?</p>
<p>What does ‘prevalent’ mean/do?</p>
<p>Let’s go ahead and stem the doc.</p>
<pre class="sourceCode r"><code class="sourceCode r">docs &lt;-<span class="st"> </span><span class="kw">tm_map</span>(docs, stemDocument)
dtm &lt;-<span class="st"> </span><span class="kw">TermDocumentMatrix</span>(docs)
m &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(dtm)
v &lt;-<span class="st"> </span><span class="kw">sort</span>(<span class="kw">rowSums</span>(m),<span class="dt">decreasing=</span><span class="ot">TRUE</span>)
d &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">words =</span> <span class="kw">names</span>(v),<span class="dt">freq=</span>v)
<span class="kw">nrow</span>(d)
<span class="kw">head</span>(d, <span class="dv">10</span>)
<span class="kw">set.seed</span>(<span class="dv">1234</span>)
<span class="kw">wordcloud</span>(
  <span class="dt">words =</span> d<span class="op">$</span>words, <span class="dt">freq =</span> d<span class="op">$</span>freq, <span class="dt">min.freq =</span> <span class="dv">1</span>,
  <span class="dt">max.words=</span><span class="dv">200</span>, <span class="dt">random.order=</span><span class="ot">FALSE</span>, <span class="dt">rot.per=</span><span class="fl">0.35</span>, 
  <span class="dt">colors=</span><span class="kw">brewer.pal</span>(<span class="dv">8</span>, <span class="st">&quot;Dark2&quot;</span>)
)</code></pre>
<p>The more fixes you make, the more the anomalies rise from the depths <a href="http://stackoverflow.com/questions/24311561/how-to-use-stemdocument-in-r" class="uri">http://stackoverflow.com/questions/24311561/how-to-use-stemdocument-in-r</a></p>
<p><br><br></p>
<p><strong>Consider also the order in which you perform these transformations (e.g. stemming, stopwords), is any repetition required?</strong></p>
<p>Try stemming first?</p>
<p>Note also that punctuation confuses wordStem so you would have to take them out as well.</p>
<p><a href="http://stackoverflow.com/questions/7263478/snowball-stemmer-only-stems-last-word" class="uri">http://stackoverflow.com/questions/7263478/snowball-stemmer-only-stems-last-word</a></p>
<p><strong>Stemming first, input is original data.</strong></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># stemming first, input is original</span>
docs &lt;-<span class="st"> </span><span class="kw">tm_map</span>(input, stemDocument, <span class="dt">language =</span> <span class="st">&quot;english&quot;</span>)  
<span class="co"># docs &lt;- tm_map(docs, stemDocument)</span>
dtm &lt;-<span class="st"> </span><span class="kw">TermDocumentMatrix</span>(docs)
m &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(dtm)
v &lt;-<span class="st"> </span><span class="kw">sort</span>(<span class="kw">rowSums</span>(m),<span class="dt">decreasing=</span><span class="ot">TRUE</span>)
d &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">words =</span> <span class="kw">names</span>(v),<span class="dt">freq=</span>v)
<span class="kw">nrow</span>(d)
<span class="kw">head</span>(d, <span class="dv">10</span>)
<span class="kw">set.seed</span>(<span class="dv">1234</span>)
<span class="kw">wordcloud</span>(<span class="dt">words =</span> d<span class="op">$</span>words, <span class="dt">freq =</span> d<span class="op">$</span>freq, <span class="dt">min.freq =</span> <span class="dv">1</span>,
          <span class="dt">max.words=</span><span class="dv">200</span>, <span class="dt">random.order=</span><span class="ot">FALSE</span>, <span class="dt">rot.per=</span><span class="fl">0.35</span>, 
          <span class="dt">colors=</span><span class="kw">brewer.pal</span>(<span class="dv">8</span>, <span class="st">&quot;Dark2&quot;</span>))
 
 
<span class="co"># Remove common English stopwords (e.g. &#39;the&#39;)</span>
docs &lt;-<span class="st"> </span><span class="kw">tm_map</span>(docs, removeWords, <span class="kw">stopwords</span>(<span class="st">&quot;english&quot;</span>))
dtm &lt;-<span class="st"> </span><span class="kw">TermDocumentMatrix</span>(docs)
m &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(dtm)
v &lt;-<span class="st"> </span><span class="kw">sort</span>(<span class="kw">rowSums</span>(m),<span class="dt">decreasing=</span><span class="ot">TRUE</span>)
d &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">words =</span> <span class="kw">names</span>(v),<span class="dt">freq=</span>v)
<span class="kw">nrow</span>(d)
<span class="kw">head</span>(d, <span class="dv">10</span>)
<span class="kw">set.seed</span>(<span class="dv">1234</span>)
<span class="kw">wordcloud</span>(<span class="dt">words =</span> d<span class="op">$</span>words, <span class="dt">freq =</span> d<span class="op">$</span>freq, <span class="dt">min.freq =</span> <span class="dv">1</span>,
          <span class="dt">max.words=</span><span class="dv">200</span>, <span class="dt">random.order=</span><span class="ot">FALSE</span>, <span class="dt">rot.per=</span><span class="fl">0.35</span>, 
          <span class="dt">colors=</span><span class="kw">brewer.pal</span>(<span class="dv">8</span>, <span class="st">&quot;Dark2&quot;</span>))</code></pre>
<div id="associations" class="section level4 unnumbered">
<h4>Associations</h4>
<p>Which words occur with, or alongside others</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">findAssocs</span>(dtm, <span class="dt">terms =</span> <span class="st">&quot;kimbal&quot;</span>, <span class="dt">corlimit =</span> <span class="dv">1</span>) <span class="co"># ha (and note lowercase, must be automated)</span></code></pre>
<p><mark class="big">What does corlimit mean here?</mark></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">findAssocs</span>(dtm, <span class="dt">terms =</span> <span class="st">&quot;text&quot;</span>, <span class="dt">corlimit =</span> <span class="fl">0.5</span>) <span class="co">#</span></code></pre>
</div>
</div>
<div id="lemmatizers" class="section level2 unnumbered">
<h2>Lemmatizers</h2>
<p>Note that lemmas differ from stems in that a lemma is the root form of the word, while a stem may not be a real word.</p>
<p>There are a few Lemmatizers about e.g.</p>
<ul>
<li>Stanford NLP</li>
<li>Treetagger</li>
<li>koRpus # seems better to install locally…</li>
<li>Wordnet</li>
<li>NLTK (Python)</li>
</ul>
<p>Here’s one that works:</p>
<p><a href="http://stackoverflow.com/questions/22993796/lemmatizer-in-r-or-python-am-are-is-berequire" class="uri">http://stackoverflow.com/questions/22993796/lemmatizer-in-r-or-python-am-are-is-berequire</a></p>
<p>You may find the url is different, it is because the Northwestern University update their URL for this service.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">require</span>(httr) <span class="co"># may have to install these two</span>
<span class="kw">require</span>(XML)
 
lemmatize &lt;-<span class="st"> </span><span class="cf">function</span>(wordlist) {
  get.lemma &lt;-<span class="st"> </span><span class="cf">function</span>(word, url) {
    response &lt;-<span class="st"> </span><span class="kw">GET</span>(url,<span class="dt">query=</span><span class="kw">list</span>(<span class="dt">spelling=</span>word,<span class="dt">standardize=</span><span class="st">&quot;&quot;</span>,
                                   <span class="dt">wordClass=</span><span class="st">&quot;&quot;</span>,<span class="dt">wordClass2=</span><span class="st">&quot;&quot;</span>,
                                   <span class="dt">corpusConfig=</span><span class="st">&quot;ncf&quot;</span>,    <span class="co"># Nineteenth Century Fiction</span>
                                   <span class="dt">media=</span><span class="st">&quot;xml&quot;</span>))
    content &lt;-<span class="st"> </span><span class="kw">content</span>(response,<span class="dt">type=</span><span class="st">&quot;text&quot;</span>)
    xml     &lt;-<span class="st"> </span><span class="kw">xmlInternalTreeParse</span>(content)
    <span class="kw">return</span>(<span class="kw">xmlValue</span>(xml[<span class="st">&quot;//lemma&quot;</span>][[<span class="dv">1</span>]]))    
  }
   
  <span class="co"># here&#39;s the code</span>
  url &lt;-<span class="st"> &quot;http://classify.at.northwestern.edu/maserver/lemmatizer&quot;</span> 
  <span class="kw">return</span>(<span class="kw">sapply</span>(wordlist,get.lemma,<span class="dt">url=</span>url))
}
 
words &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;is&quot;</span>,<span class="st">&quot;am&quot;</span>,<span class="st">&quot;was&quot;</span>,<span class="st">&quot;are&quot;</span>)
<span class="kw">lemmatize</span>(words)
<span class="co"># is am  was  are </span>
<span class="co"># &quot;be&quot; &quot;be&quot; &quot;be&quot; &quot;be&quot; </span>
<span class="co"># &#39;to be&#39;</span>
words &lt;-<span class="st"> </span><span class="kw">c</span>(
  <span class="st">&quot;walk&quot;</span>,<span class="st">&quot;walking&quot;</span>,<span class="st">&quot;walked&quot;</span>,<span class="st">&quot;walk&quot;</span>,
  <span class="st">&quot;Walker&quot;</span>, <span class="st">&quot;walks&quot;</span>, <span class="st">&quot;Walker Texas Ranger&quot;</span>,
  <span class="st">&quot;sidewalk&quot;</span>
  )
<span class="kw">lemmatize</span>(words)
words &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Walker Texas Ranger&quot;</span>,<span class="st">&quot;range&quot;</span>,<span class="st">&quot;ranger&quot;</span>,<span class="st">&quot;ranged&quot;</span>,<span class="st">&quot;rangy&quot;</span>,<span class="st">&quot;Ranger&quot;</span>) 
<span class="co"># so ranger as in rang a bell!? &lt;sigh&gt; English &lt;/sigh&gt;</span>
<span class="kw">lemmatize</span>(words)</code></pre>
</div>
<div id="text-networks" class="section level2">
<h2><span class="header-section-number">5.2</span> Text networks</h2>
<p>We can apply network analysis to text, or more precisely terms or words in text and their connections</p>
<p>e.g. ‘data’ and ‘mining’ may commonly occur together</p>
<p>Below is a selection of terms from a document with connections between them represented as a matrix</p>
<p>Data file download: <a href="diagrams_datasets/section5/termDocMatrix.rdata">termDocMatrix.rdata</a></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># load termDocMatrix</span>
<span class="kw">load</span>(<span class="st">&quot;termDocMatrix.rdata&quot;</span>)
<span class="co"># inspect part of the matrix</span>
termDocMatrix[<span class="dv">5</span><span class="op">:</span><span class="dv">10</span>,<span class="dv">1</span><span class="op">:</span><span class="dv">20</span>]
<span class="co"># Transform Data into an Adjacency Matrix</span>
<span class="co"># change it to a Boolean matrix</span>
termDocMatrix[termDocMatrix<span class="op">&gt;=</span><span class="dv">1</span>] &lt;-<span class="st"> </span><span class="dv">1</span>
<span class="co"># transform into a term-term adjacency matrix</span>
termMatrix &lt;-<span class="st"> </span>termDocMatrix <span class="op">%*%</span><span class="st"> </span><span class="kw">t</span>(termDocMatrix)
<span class="co"># inspect terms numbered 5 to 10</span>
termMatrix[<span class="dv">5</span><span class="op">:</span><span class="dv">10</span>,<span class="dv">5</span><span class="op">:</span><span class="dv">10</span>]</code></pre>
<p>Why is ‘data’ most commonly associated with ‘data’ i.e. what does ‘data’ 53 mean?</p>
<p>Inspect the diagonal (top left to bottom right)</p>
<p>Build a graph from the matrix:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(igraph)
 
g &lt;-<span class="st"> </span><span class="kw">graph.adjacency</span>(termMatrix, <span class="dt">weighted=</span>T, <span class="dt">mode =</span> <span class="st">&quot;undirected&quot;</span>)
 
<span class="co"># remove loops</span>
g &lt;-<span class="st"> </span><span class="kw">simplify</span>(g)
 
<span class="co"># set labels of vertices</span>
<span class="kw">V</span>(g)<span class="op">$</span>label &lt;-<span class="st"> </span><span class="kw">V</span>(g)<span class="op">$</span>name
 
<span class="co"># set seed to make the layout reproducible</span>
<span class="kw">set.seed</span>(<span class="dv">3952</span>)
layout1 &lt;-<span class="st"> </span><span class="kw">layout.fruchterman.reingold</span>(g)
<span class="kw">plot</span>(g, <span class="dt">layout=</span>layout1)
<span class="co"># plot(g, layout=layout.kamada.kawai)</span></code></pre>
<p>How many times did ‘r’ occur in the text?</p>
<p>Try other layouts.</p>
<p>Which is better to learn about relationships between data, the matrix or the graph?</p>
<hr />

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="exploring-text-and-document-collections.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="activity-textual-exploration-with-voyant-tools.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"download": ["_main.pdf"],
"toc": {
"collapse": "Module"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
