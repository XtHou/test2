<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>4 Activity: Advanced plots with R | Module 2 Making sense of tabular data</title>
  <meta name="description" content="This is the second module in the FIT5147 Data Exploration and Visualisation unit. In this module you will learn about common graphics for showing tabular data. These are the kind of graphics that are common in statistics.">
  <meta name="generator" content="bookdown  and GitBook 2.6.7">

  <meta property="og:title" content="4 Activity: Advanced plots with R | Module 2 Making sense of tabular data" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is the second module in the FIT5147 Data Exploration and Visualisation unit. In this module you will learn about common graphics for showing tabular data. These are the kind of graphics that are common in statistics." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="4 Activity: Advanced plots with R | Module 2 Making sense of tabular data" />
  
  <meta name="twitter:description" content="This is the second module in the FIT5147 Data Exploration and Visualisation unit. In this module you will learn about common graphics for showing tabular data. These are the kind of graphics that are common in statistics." />
  

<meta name="author" content="Kimbal Marriott">



  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="analysis-of-trends-and-patterns.html">
<link rel="next" href="activity-interactive-charts-with-r.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />










<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><strong><a href="./">Module 2 Making sense of tabular data</a></strong></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Making sense of tabular data: Overview</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#aims-of-this-module"><i class="fa fa-check"></i><b>1.1</b> Aims of this module</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#how-to-study-for-this-module"><i class="fa fa-check"></i><b>1.2</b> How to study for this module</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="visualising-tabular-data.html"><a href="visualising-tabular-data.html"><i class="fa fa-check"></i><b>2</b> Visualising tabular data</a><ul>
<li class="chapter" data-level="2.1" data-path="visualising-tabular-data.html"><a href="visualising-tabular-data.html#basic-statistical-graphics"><i class="fa fa-check"></i><b>2.1</b> Basic statistical graphics</a></li>
<li class="chapter" data-level="2.2" data-path="visualising-tabular-data.html"><a href="visualising-tabular-data.html#multivariate-data"><i class="fa fa-check"></i><b>2.2</b> Multivariate data</a></li>
<li class="chapter" data-level="2.3" data-path="visualising-tabular-data.html"><a href="visualising-tabular-data.html#showing-3d"><i class="fa fa-check"></i><b>2.3</b> Showing 3D</a></li>
<li class="chapter" data-level="2.4" data-path="visualising-tabular-data.html"><a href="visualising-tabular-data.html#additional-visual-attributes"><i class="fa fa-check"></i><b>2.4</b> Additional visual attributes</a></li>
<li class="chapter" data-level="2.5" data-path="visualising-tabular-data.html"><a href="visualising-tabular-data.html#multiple-charts"><i class="fa fa-check"></i><b>2.5</b> Multiple charts</a></li>
<li class="chapter" data-level="2.6" data-path="visualising-tabular-data.html"><a href="visualising-tabular-data.html#overlay-graphic-elements"><i class="fa fa-check"></i><b>2.6</b> Overlay graphic elements</a></li>
<li class="chapter" data-level="2.7" data-path="visualising-tabular-data.html"><a href="visualising-tabular-data.html#parallel-coordinates"><i class="fa fa-check"></i><b>2.7</b> Parallel coordinates</a></li>
<li class="chapter" data-level="2.8" data-path="visualising-tabular-data.html"><a href="visualising-tabular-data.html#dimension-reduction"><i class="fa fa-check"></i><b>2.8</b> Dimension reduction</a><ul>
<li class="chapter" data-level="2.8.1" data-path="visualising-tabular-data.html"><a href="visualising-tabular-data.html#multidimensional-scaling-example"><i class="fa fa-check"></i><b>2.8.1</b> Multidimensional scaling example</a></li>
</ul></li>
<li class="chapter" data-level="2.9" data-path="visualising-tabular-data.html"><a href="visualising-tabular-data.html#summary"><i class="fa fa-check"></i><b>2.9</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="analysis-of-trends-and-patterns.html"><a href="analysis-of-trends-and-patterns.html"><i class="fa fa-check"></i><b>3</b> Analysis of trends and patterns</a><ul>
<li class="chapter" data-level="3.1" data-path="analysis-of-trends-and-patterns.html"><a href="analysis-of-trends-and-patterns.html#simple-linear-regression"><i class="fa fa-check"></i><b>3.1</b> Simple linear regression</a></li>
<li class="chapter" data-level="3.2" data-path="analysis-of-trends-and-patterns.html"><a href="analysis-of-trends-and-patterns.html#checking-for-normality"><i class="fa fa-check"></i><b>3.2</b> Checking for normality</a></li>
<li class="chapter" data-level="3.3" data-path="analysis-of-trends-and-patterns.html"><a href="analysis-of-trends-and-patterns.html#data-transformation"><i class="fa fa-check"></i><b>3.3</b> Data transformation</a></li>
<li class="chapter" data-level="3.4" data-path="analysis-of-trends-and-patterns.html"><a href="analysis-of-trends-and-patterns.html#other-kinds-of-curve-fitting"><i class="fa fa-check"></i><b>3.4</b> Other kinds of curve fitting</a></li>
<li class="chapter" data-level="3.5" data-path="analysis-of-trends-and-patterns.html"><a href="analysis-of-trends-and-patterns.html#uncertainty"><i class="fa fa-check"></i><b>3.5</b> Uncertainty</a></li>
<li class="chapter" data-level="3.6" data-path="analysis-of-trends-and-patterns.html"><a href="analysis-of-trends-and-patterns.html#clustering"><i class="fa fa-check"></i><b>3.6</b> Clustering</a></li>
<li class="chapter" data-level="3.7" data-path="analysis-of-trends-and-patterns.html"><a href="analysis-of-trends-and-patterns.html#hierarchical-clustering"><i class="fa fa-check"></i><b>3.7</b> Hierarchical clustering</a></li>
<li class="chapter" data-level="3.8" data-path="analysis-of-trends-and-patterns.html"><a href="analysis-of-trends-and-patterns.html#summary-1"><i class="fa fa-check"></i><b>3.8</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="activity-advanced-plots-with-r.html"><a href="activity-advanced-plots-with-r.html"><i class="fa fa-check"></i><b>4</b> Activity: Advanced plots with R</a><ul>
<li class="chapter" data-level="4.1" data-path="activity-advanced-plots-with-r.html"><a href="activity-advanced-plots-with-r.html#introducing-ggplot2"><i class="fa fa-check"></i><b>4.1</b> Introducing ggplot2</a><ul>
<li class="chapter" data-level="4.1.1" data-path="activity-advanced-plots-with-r.html"><a href="activity-advanced-plots-with-r.html#the-philosophy"><i class="fa fa-check"></i><b>4.1.1</b> The philosophy</a></li>
<li class="chapter" data-level="4.1.2" data-path="activity-advanced-plots-with-r.html"><a href="activity-advanced-plots-with-r.html#layers"><i class="fa fa-check"></i><b>4.1.2</b> Layers</a></li>
<li class="chapter" data-level="4.1.3" data-path="activity-advanced-plots-with-r.html"><a href="activity-advanced-plots-with-r.html#aesthetics"><i class="fa fa-check"></i><b>4.1.3</b> Aesthetics</a></li>
<li class="chapter" data-level="4.1.4" data-path="activity-advanced-plots-with-r.html"><a href="activity-advanced-plots-with-r.html#geometric-objects-geoms"><i class="fa fa-check"></i><b>4.1.4</b> Geometric objects (geoms)</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="activity-advanced-plots-with-r.html"><a href="activity-advanced-plots-with-r.html#visualisation-with-ggplot2"><i class="fa fa-check"></i><b>4.2</b> visualisation with ggplot2</a><ul>
<li class="chapter" data-level="" data-path="activity-advanced-plots-with-r.html"><a href="activity-advanced-plots-with-r.html#step-1.-read-the-data"><i class="fa fa-check"></i>Step 1. read the data</a></li>
<li class="chapter" data-level="" data-path="activity-advanced-plots-with-r.html"><a href="activity-advanced-plots-with-r.html#step-2.-first-graph"><i class="fa fa-check"></i>Step 2. first graph</a></li>
<li class="chapter" data-level="" data-path="activity-advanced-plots-with-r.html"><a href="activity-advanced-plots-with-r.html#step-3.-change-the-shape"><i class="fa fa-check"></i>Step 3. change the shape</a></li>
<li class="chapter" data-level="" data-path="activity-advanced-plots-with-r.html"><a href="activity-advanced-plots-with-r.html#step-4.-change-the-color"><i class="fa fa-check"></i>Step 4. change the color</a></li>
<li class="chapter" data-level="" data-path="activity-advanced-plots-with-r.html"><a href="activity-advanced-plots-with-r.html#step-5.-facet"><i class="fa fa-check"></i>Step 5. Facet</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="activity-advanced-plots-with-r.html"><a href="activity-advanced-plots-with-r.html#starting-at-the-end"><i class="fa fa-check"></i><b>4.3</b> Starting At The End</a></li>
<li class="chapter" data-level="4.4" data-path="activity-advanced-plots-with-r.html"><a href="activity-advanced-plots-with-r.html#now-continue-with-the-basic-examples-in-the-ggplot2-cheat-sheet"><i class="fa fa-check"></i><b>4.4</b> Now continue with the basic examples in the ggplot2 ‘cheat sheet’</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="activity-interactive-charts-with-r.html"><a href="activity-interactive-charts-with-r.html"><i class="fa fa-check"></i><b>5</b> Activity: Interactive charts with R</a><ul>
<li class="chapter" data-level="5.1" data-path="activity-interactive-charts-with-r.html"><a href="activity-interactive-charts-with-r.html#shiny"><i class="fa fa-check"></i><b>5.1</b> Shiny</a><ul>
<li class="chapter" data-level="5.1.1" data-path="activity-interactive-charts-with-r.html"><a href="activity-interactive-charts-with-r.html#structure-of-a-shiny-app"><i class="fa fa-check"></i><b>5.1.1</b> Structure of a Shiny App</a></li>
<li class="chapter" data-level="5.1.2" data-path="activity-interactive-charts-with-r.html"><a href="activity-interactive-charts-with-r.html#shiny-with-ggplot"><i class="fa fa-check"></i><b>5.1.2</b> Shiny with ggplot</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="activity-interactive-charts-with-r.html"><a href="activity-interactive-charts-with-r.html#other-ways"><i class="fa fa-check"></i><b>5.2</b> Other Ways</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="activity-clustering-with-r.html"><a href="activity-clustering-with-r.html"><i class="fa fa-check"></i><b>6</b> Activity: Clustering with R</a><ul>
<li class="chapter" data-level="6.1" data-path="activity-clustering-with-r.html"><a href="activity-clustering-with-r.html#clustering-irises-data"><i class="fa fa-check"></i><b>6.1</b> Clustering “irises” data</a></li>
<li class="chapter" data-level="6.2" data-path="activity-clustering-with-r.html"><a href="activity-clustering-with-r.html#clustering-crickets-data"><i class="fa fa-check"></i><b>6.2</b> Clustering “crickets” data</a></li>
<li class="chapter" data-level="6.3" data-path="activity-clustering-with-r.html"><a href="activity-clustering-with-r.html#hierarchical-clustering-1"><i class="fa fa-check"></i><b>6.3</b> Hierarchical clustering</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Module 2 Making sense of tabular data</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="activity-advanced-plots-with-r" class="section level1">
<h1><span class="header-section-number">4</span> Activity: Advanced plots with R</h1>
<p>You have to install ggplot2 package to continue this activity.</p>
<p>If you do not have, follow the instructions at: <a href="">Introduction to RStudio</a>.</p>
<p><strong>Part 4.1</strong>, Introducing ggplot2</p>
<p><strong>Part 4.2</strong>, visualisation with ggplot2</p>
<p><strong>Part 4.3</strong>, ‘Starting at the end’ shows how to use ggplot2 to produce a newsprint quality plot</p>
<div id="introducing-ggplot2" class="section level2">
<h2><span class="header-section-number">4.1</span> Introducing ggplot2</h2>
<p>The library is ggplot2, the function is ggplot – watch out for that.</p>
<p>Based on Chapter 4.4. “Introducing ggplot2” in “Discovering Statistics Using R”, Andy Field, Jeremy Miles and Zoë Field (2012) and the ‘ggplot cheat sheet’ e.g.</p>
<p><a href="https://www.rstudio.com/wp-content/uploads/2016/11/ggplot2-cheatsheet-2.1.pdf">ggplot cheatsheet</a></p>
<div id="the-philosophy" class="section level3">
<h3><span class="header-section-number">4.1.1</span> The philosophy</h3>
<p>ggplot2 is the implementation of the famous article “A Layered Grammar of Graphics” by Hadley Wickham.</p>
<p>It is designed to create a well-structured <strong>statistical graphics</strong> (by layers).</p>
</div>
<div id="layers" class="section level3">
<h3><span class="header-section-number">4.1.2</span> Layers</h3>
<p>In ggplot2, a graph is made up of a series of <strong>layers</strong>.</p>
<p>You can think of a layer as a transparency with something printed on it. That “<strong>something</strong>” could be</p>
<ul>
<li>points</li>
<li>lines</li>
<li>bars</li>
<li>symbols (circles, squares for data points)</li>
</ul>
<p>and also:</p>
<ul>
<li>legends</li>
<li>axis title</li>
<li>axis tick</li>
<li>and etc.</li>
</ul>
<p>To make a the final plot, these transparencies are placed on top of each other.</p>
<p><img src="diagrams_datasets/section4/Layers.png" /></p>
<p>How to create the above figure?</p>
<p>Imagine you begin with a transparent sheet that has a grid and axes of the graph drawn on it (the first sub-figure).</p>
<p>On a second transparent sheet you have the data (the second sub-figure).</p>
<p>On a third transparency you have labels and a title (the third sub-figure).</p>
<p>To make the final graph, you put these three layers together: you start with the axes, lay the data on top of that, and finally lay the labels on top of that (the last sub-figure).</p>
<p>The end result is a scatter plot of ‘miles per gallon, city vs highway’. You can extend the idea of layers beyond the figure: you could imagine having a layer that contains a legend, or a regression line.</p>
<p><br><br></p>
<p>As can be seen, each layer contains visual objects such as bars, points, text and so on. Visual elements are known as <strong>geoms</strong> (short for ‘geometric objects’) in ggplot2. Therefore, when we define a layer, we have to tell R what geom we want displayed on that layer (do we want a bar, line, dot, etc.?).</p>
</div>
<div id="aesthetics" class="section level3">
<h3><span class="header-section-number">4.1.3</span> Aesthetics</h3>
<p>These geoms also have aesthetic properties that determine what they look like and where they are plotted (do we want red bars or green ones? do we want our data point to be a triangle or a square? etc.).</p>
<p>These aesthetics (<strong>aes()</strong> for short) control the appearance of graph elements (for example, their colour, size, style and location).</p>
<p>Aesthetics can be defined in general for the whole plot, or individually for a specific layer. They control the appearance of elements within a geom or layer.</p>
<p><mark class="yellow"><strong><em>The aesthetics specify how to map from a data attribute to a visual or geometric attribute.</em></strong></mark></p>
</div>
<div id="geometric-objects-geoms" class="section level3">
<h3><span class="header-section-number">4.1.4</span> Geometric objects (geoms)</h3>
<p>There are a variety of geom functions that determine what kind of geometric object is printed on a layer. Here is a list of a few of the more common ones that you might use (for a full list see the ggplot2 website <a href="http://ggplot2.tidyverse.org/reference/" class="uri">http://ggplot2.tidyverse.org/reference/</a> or you can let R tell you, see below):</p>
<ul>
<li>geom_bar(): creates a layer with bars representing different statistical properties.</li>
<li>geom_point(): creates a layer showing the data points (as you would see on a scatterplot).</li>
<li>geom_line(): creates a layer that connects data points with a straight line.</li>
<li>geom_smooth(): creates a layer that contains a ‘smoother’ (i.e., a line that summarizes the data as a whole rather than connecting individual data points).</li>
<li>geom_histogram(): creates a layer with a histogram on it.</li>
<li>geom_boxplot(): creates a layer with a box–whisker diagram.</li>
<li>geom_text(): creates a layer with text on it.</li>
<li>geom_density(): creates a layer with a density plot on it.</li>
<li>geom_errorbar(): creates a layer with error bars displayed on it.</li>
<li>geom_hline(), geom_vline(): straight lines</li>
</ul>
<p>Start by loading the ggplot library, use the following code:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">require</span>(ggplot2) <span class="co"># load ggplot2 first</span></code></pre>
<p>Try this: type “<code>geom_</code>” then TAB to see options.</p>
<p>Will this work if ggplot2 is not loaded? (But don’t run this, no point)</p>
<p><code>geom_</code></p>
<p>Here’s the syntax (not real code) for a ggplot:</p>
<pre><code>myGraph &lt;- ggplot(myData, aes(variable for x axis, variable for y axis))</code></pre>
<p>We need to have the data first. Here, let’s look at a built-in data set <code>mtcars</code>.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">help</span>(mtcars) </code></pre>
<p>If you do not understand something in R, try use the <code>help</code> function.</p>
<p>Usually, you will be lucky enough. The output will be at the <strong>right bottom</strong> section of RStudio.</p>
<p>Why not try something else.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str</span>(mtcars) 
<span class="kw">summary</span>(mtcars) </code></pre>
<p>What does all the outputs mean?
<br><br></p>
<p><mark class="big"><strong>drat!, still not sure what a “drat” is, and “vs” ?</strong></mark></p>
<p>stackoverflow to the rescue:
<a href="http://stackoverflow.com/questions/18617174/r-mtcars-dataset-meaning-of-vs-variable" class="uri">http://stackoverflow.com/questions/18617174/r-mtcars-dataset-meaning-of-vs-variable</a>
<br><br></p>
<p>Now, we use this data set and let x &amp; y be <code>mpg</code> and <code>hp</code>.</p>
<p>What are the meanings of <code>mpg</code> and <code>hp</code> in this data set?</p>
<pre class="sourceCode r"><code class="sourceCode r">myGraph &lt;-<span class="st"> </span><span class="kw">ggplot</span>(mtcars, <span class="kw">aes</span>(mpg, hp))</code></pre>
<p>This is actually the same as, which might be more clear:</p>
<pre class="sourceCode r"><code class="sourceCode r">myGraph &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> mtcars, <span class="kw">aes</span>(<span class="dt">x =</span> mpg, <span class="dt">y =</span> hp))</code></pre>
<p>Nothing happened? Well, all this does is grab some data (from <code>mtcars</code>) and save some of it (<code>mpg</code>, and <code>hp</code>) in a graphic variable (<code>myGraph</code>).</p>
<p>Let’s see this <code>myGraph</code> by running:</p>
<pre class="sourceCode r"><code class="sourceCode r">myGraph</code></pre>
<p>Still nothing to see?</p>
<p>If you are running RStudio 1.0.136, look carefully at your <strong>right bottom</strong> section of RStudio (<strong>Plots</strong> tab).</p>
<p><img src="diagrams_datasets/section4/2.1-R-011.png" /></p>
<p>If you cannot see this figure, it is totally all right. It is probably because of R or RStudio version issue.</p>
<p>Just move on. Anyway, this figure does not make any sense. It is empty. Where are the data?</p>
<p>Actually we have specified the data and a “canvas” through the previous code, but we haven’t specified any chart/graph/plot.</p>
<pre class="sourceCode r"><code class="sourceCode r">myGraph <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>() <span class="co"># so now there&#39;s a layer added</span></code></pre>
<p>Or we want them to be blue.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># with some colour</span>
myGraph <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="dt">colour =</span> <span class="st">&quot;Blue&quot;</span>) 
<span class="co"># store the graph in a variable</span>
g1 &lt;-<span class="st"> </span>myGraph <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="dt">colour =</span> <span class="st">&quot;Blue&quot;</span>) 
<span class="co"># have to run it alone, to plot it in RStudio</span>
g1                                          </code></pre>
</div>
</div>
<div id="visualisation-with-ggplot2" class="section level2">
<h2><span class="header-section-number">4.2</span> visualisation with ggplot2</h2>
<p>Let’s do some real visualisations with ggplot2.</p>
<p>Here is the data of the number of staff for one company in Australia: <a href="sample-data-for-r-plot3.txt">sample-data-for-r-plot3.txt</a>.</p>
<p><img src="diagrams_datasets/section4/2.1-R-02.png" /></p>
<p>（look, it is with the “row-oriented table” format）
<br><br></p>
<div id="step-1.-read-the-data" class="section level3 unnumbered">
<h3>Step 1. read the data</h3>
<p>Remember to first set your working directory if you are using relative path.</p>
<pre class="sourceCode r"><code class="sourceCode r">myData &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&#39;sample-data-for-r-plot3.txt&#39;</span>)</code></pre>
<p>One thing you need to pay attention is how R will store your data.</p>
<p>Look at the <strong>right top</strong> section of RStudio.</p>
<p>R will try to detect the data types of your data automatically. Make sure they are stored in the right type you want.</p>
<p><img src="diagrams_datasets/section4/2.1-R-031.png" /></p>
</div>
<div id="step-2.-first-graph" class="section level3 unnumbered">
<h3>Step 2. first graph</h3>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(ggplot2)
<span class="kw">ggplot</span>(myData, <span class="kw">aes</span>(Year, Number)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>()</code></pre>
<p><img src="diagrams_datasets/section4/2.1-R-04.png" /></p>
<p>Points again, but this is not that interesting.</p>
<p>You definitely want to distinguish the points by its other properties.</p>
<p>Add dimensions!</p>
</div>
<div id="step-3.-change-the-shape" class="section level3 unnumbered">
<h3>Step 3. change the shape</h3>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(myData, <span class="kw">aes</span>(Year, Number)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">shape =</span> Sex))</code></pre>
<p><img src="diagrams_datasets/section4/2.1-R-05.png" /></p>
<p>Still feel messy? Add more dimensions!</p>
</div>
<div id="step-4.-change-the-color" class="section level3 unnumbered">
<h3>Step 4. change the color</h3>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(myData, <span class="kw">aes</span>(Year, Number)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">shape =</span> Sex, <span class="dt">color =</span> State))</code></pre>
<p><img src="diagrams_datasets/section4/2.1-R-06.png" /></p>
<p>Feel better? What else can we do with visual elements?</p>
<p>Of course, size.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(myData, <span class="kw">aes</span>(Year, Number)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">shape =</span> Sex, <span class="dt">color =</span> State, <span class="dt">size =</span> Sex))</code></pre>
<p><img src="diagrams_datasets/section4/2.1-R-07.png" /></p>
<p>However, it does not make any sense at all…</p>
<p>So, do not just blindly change the parameters, make sure you understand their meaning.</p>
<p>Of course, trying is always encouraged!</p>
</div>
<div id="step-5.-facet" class="section level3 unnumbered">
<h3>Step 5. Facet</h3>
<p>I still have the feeling it is too crowded.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(myData, <span class="kw">aes</span>(Year, Number)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">color =</span> State)) <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>Sex)</code></pre>
<p><img src="diagrams_datasets/section4/2.1-R-08-768x290.png" /></p>
<p>Or the other way around:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(myData, <span class="kw">aes</span>(Year, Number)) <span class="op">+</span><span class="st"> </span>
<span class="st"> </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">shape =</span> Sex)) <span class="op">+</span>
<span class="st"> </span><span class="kw">facet_wrap</span>(<span class="op">~</span>State, <span class="dt">nrow =</span> <span class="dv">1</span>)</code></pre>
<p><img src="diagrams_datasets/section4/2.1-R-09-768x227.png" /></p>
<p>Or the “ultimate” way:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(myData, <span class="kw">aes</span>(Year, Number)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_grid</span>(Sex<span class="op">~</span>State)</code></pre>
<p><img src="diagrams_datasets/section4/2.1-R-10-768x249.png" /></p>
<p>Which do you prefer?</p>
<p>All data in one graph, using visual properties (shape, color, size) to distinguish them.</p>
<p>Or, split the data and show them in small graphs? <strong>Why</strong>?
<br><br></p>
<p>We are not going to stop here.</p>
<p>Can we change it to a bar chart?</p>
<p>It should work with:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(myData, <span class="kw">aes</span>(Year, Number)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_bar</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_grid</span>(Sex<span class="op">~</span>State)</code></pre>
<p>But:</p>
<p><img src="diagrams_datasets/section4/2.1-R-11.png" /></p>
<p>This is because, by default, <code>geom_bar</code> will count the records, but our <code>Number</code> column is not designed for counting.</p>
<p>We can change the bar chart to behave as we want.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(myData, <span class="kw">aes</span>(Year, Number)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_grid</span>(Sex<span class="op">~</span>State)</code></pre>
<p><img src="diagrams_datasets/section4/2.1-R-12-768x230.png" /></p>
<p>So when you want to change your graph to a different form.</p>
<p>You may need to do more than just change the <code>geom_ part</code>.</p>
<p>Look it up for more details.</p>
<p><mark class="big"><strong>There are many more examples in the ggplot2 ‘cheat sheet’, try them now or later.</strong></mark></p>
<p><a href="https://www.rstudio.com/wp-content/uploads/2016/11/ggplot2-cheatsheet-2.1.pdf">ggplot cheatsheet</a></p>
<p>There are actually two ways to do plots with ggplot2:</p>
<ul>
<li>do a quick plot using the qplot() function; and</li>
<li>build a plot layer by layer using the ggplot() function.</li>
</ul>
<p>Undoubtedly the qplot() function will get you started quicker; however, the ggplot() function offers greater versatility.</p>
<p>Next up is a reproduction of a print quality chart used by ‘The Economist’.
<br><br></p>
</div>
</div>
<div id="starting-at-the-end" class="section level2">
<h2><span class="header-section-number">4.3</span> Starting At The End</h2>
<p>By the end of this section you will be able to reproduce the chart like this from the Economist:</p>
<p><img src="diagrams_datasets/section4/Economist.jpg" /></p>
<p>It suggests a correlation between corruption and development.</p>
<p>A bit more background information about the data:</p>
<p>The use of public office for private gain benefits a powerful few while imposing costs on large swathes of society. Transparency International’s annual Corruption Perceptions Index, published on December 1st, measures the perceived levels of public-sector graft by aggregating independent surveys from across the globe. Just four non-OECD countries make the top 25: Singapore, Barbados, Bahamas and Qatar. The bottom is formed mainly of failed states, poor African countries and nations that either were once communist (Turkmenistan) or are still run along similar lines (Venezuela, Cuba). Comparing the corruption index with the UN’s Human Development Index (a measure combining health, wealth and education), demonstrates an interesting connection. When the corruption index is between approximately 2.0 and 4.0 there appears to be little relationship with the human development index, but as it rises beyond 4.0 a stronger connection can be seen. Outliers include small but well-run poorer countries such as Bhutan and Cape Verde, while Greece and Italy stand out among the richer countries.</p>
<p><a href="http://www.economist.com/blogs/dailychart/2011/12/corruption-and-development" class="uri">http://www.economist.com/blogs/dailychart/2011/12/corruption-and-development</a>
<br><br></p>
<p>Here’s the data <a href="EconomistData.csv">EconomistData</a></p>
<pre class="sourceCode r"><code class="sourceCode r">dat &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;EconomistData.csv&quot;</span>) 
<span class="co"># load data, don&#39;t ask where I got it, there may have been a bribe involved...</span>
<span class="kw">head</span>(dat) <span class="co"># look at some of the data</span></code></pre>
<p>plot it!</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(dat, <span class="kw">aes</span>(<span class="dt">x =</span> CPI, <span class="dt">y =</span> HDI)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>()</code></pre>
<p>That’s fairly basic, add some colour &amp; a legend</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># colour!</span>
plot1 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(dat, <span class="kw">aes</span>(<span class="dt">x =</span> CPI, <span class="dt">y =</span> HDI, <span class="dt">color =</span> Region)) 
<span class="co"># now we&#39;re saving the stages, and reusing them, plot1, plot2 etc.</span>
plot1 &lt;-<span class="st"> </span>plot1 <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="dt">shape =</span> <span class="dv">1</span>) 
plot1</code></pre>
<p>Add labels</p>
<pre class="sourceCode r"><code class="sourceCode r">labels &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Congo&quot;</span>, <span class="st">&quot;Sudan&quot;</span>, <span class="st">&quot;Afghanistan&quot;</span>, <span class="st">&quot;Greece&quot;</span>, <span class="st">&quot;China&quot;</span>,
                 <span class="st">&quot;India&quot;</span>, <span class="st">&quot;Rwanda&quot;</span>, <span class="st">&quot;Spain&quot;</span>, <span class="st">&quot;France&quot;</span>, 
            <span class="st">&quot;United States&quot;</span>, <span class="st">&quot;Japan&quot;</span>, <span class="st">&quot;Norway&quot;</span>, <span class="st">&quot;Singapore&quot;</span>)
plot2 &lt;-<span class="st"> </span>plot1 <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_text</span>(<span class="kw">aes</span>(<span class="dt">label =</span> Country),
           <span class="dt">color =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">size =</span> <span class="dv">3</span>, <span class="dt">hjust =</span> <span class="fl">1.1</span>,
           <span class="dt">data =</span> dat[dat<span class="op">$</span>Country <span class="op">%in%</span><span class="st"> </span>labels, ])
plot2</code></pre>
<p>Add regression line</p>
<pre class="sourceCode r"><code class="sourceCode r">plot3 &lt;-<span class="st"> </span>plot2 <span class="op">+</span>
<span class="st">   </span><span class="kw">geom_smooth</span>(<span class="kw">aes</span>(<span class="dt">group =</span> <span class="dv">1</span>),
               <span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>,
               <span class="dt">color =</span> <span class="st">&quot;black&quot;</span>,
               <span class="dt">formula =</span> y<span class="op">~</span><span class="st"> </span><span class="kw">poly</span>(x, <span class="dv">2</span>),
               <span class="dt">se =</span> <span class="ot">FALSE</span>)
plot3</code></pre>
<p>Tidy it up!</p>
<pre class="sourceCode r"><code class="sourceCode r">plot4 &lt;-<span class="st"> </span>plot3 <span class="op">+</span><span class="st"> </span><span class="kw">theme_bw</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="st">&quot;Corruption Perceptions Index, 2011</span><span class="ch">\n</span><span class="st">(10 = least corrupt)&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="st">&quot;Human Development Index, 2011</span><span class="ch">\n</span><span class="st">(1 = best)&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;top&quot;</span>, <span class="dt">legend.direction =</span> <span class="st">&quot;horizontal&quot;</span>)
plot4</code></pre>
<p>Your turn, fix it up a bit more, look at the far left, one country got cut off</p>
<p>Now add labels for Australia &amp; NZ.</p>
<p><strong>What is SSA? MENA? fix that too</strong></p>
<p><strong>“East EU Cemt Asia”?</strong></p>
</div>
<div id="now-continue-with-the-basic-examples-in-the-ggplot2-cheat-sheet" class="section level2">
<h2><span class="header-section-number">4.4</span> Now continue with the basic examples in the ggplot2 ‘cheat sheet’</h2>
<p><a href="https://www.rstudio.com/wp-content/uploads/2015/03/ggplot2-cheatsheet.pdf" class="uri">https://www.rstudio.com/wp-content/uploads/2015/03/ggplot2-cheatsheet.pdf</a></p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="analysis-of-trends-and-patterns.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="activity-interactive-charts-with-r.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "Module"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
