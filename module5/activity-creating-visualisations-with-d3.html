<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>5 Activity: Creating visualisations with D3 | Module 5 Effective data visualisation</title>
  <meta name="description" content="This is the fifth module in the Data Exploration and Visualisation unit. In this module you will learn about the human visual system and how humans communicate. By understanding these you will be able to design more effective visualisations that take into account human perceptual and cognitive strengths and limitations.">
  <meta name="generator" content="bookdown  and GitBook 2.6.7">

  <meta property="og:title" content="5 Activity: Creating visualisations with D3 | Module 5 Effective data visualisation" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is the fifth module in the Data Exploration and Visualisation unit. In this module you will learn about the human visual system and how humans communicate. By understanding these you will be able to design more effective visualisations that take into account human perceptual and cognitive strengths and limitations." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="5 Activity: Creating visualisations with D3 | Module 5 Effective data visualisation" />
  
  <meta name="twitter:description" content="This is the fifth module in the Data Exploration and Visualisation unit. In this module you will learn about the human visual system and how humans communicate. By understanding these you will be able to design more effective visualisations that take into account human perceptual and cognitive strengths and limitations." />
  

<meta name="author" content="Kimbal Marriott">



  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="activity-basic-web-development-skills.html">
<link rel="next" href="activity-effective-graphic-design.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />










<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><strong><a href="./">Module 5 Effective data visualisation</a></strong></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Effective data visualisation: Overview</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#aims-of-this-module"><i class="fa fa-check"></i><b>1.1</b> Aims of this module</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#how-to-study-for-this-module"><i class="fa fa-check"></i><b>1.2</b> How to study for this module</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="the-human-visual-system.html"><a href="the-human-visual-system.html"><i class="fa fa-check"></i><b>2</b> The human visual system</a><ul>
<li class="chapter" data-level="2.1" data-path="the-human-visual-system.html"><a href="the-human-visual-system.html#overview-of-visual-system"><i class="fa fa-check"></i><b>2.1</b> Overview of visual system</a></li>
<li class="chapter" data-level="2.2" data-path="the-human-visual-system.html"><a href="the-human-visual-system.html#the-eye"><i class="fa fa-check"></i><b>2.2</b> The eye</a></li>
<li class="chapter" data-level="2.3" data-path="the-human-visual-system.html"><a href="the-human-visual-system.html#marks-and-channels"><i class="fa fa-check"></i><b>2.3</b> Marks and channels</a></li>
<li class="chapter" data-level="2.4" data-path="the-human-visual-system.html"><a href="the-human-visual-system.html#colour"><i class="fa fa-check"></i><b>2.4</b> Colour</a></li>
<li class="chapter" data-level="2.5" data-path="the-human-visual-system.html"><a href="the-human-visual-system.html#colour-blindness-accessibility"><i class="fa fa-check"></i><b>2.5</b> Colour-blindness &amp; accessibility</a></li>
<li class="chapter" data-level="2.6" data-path="the-human-visual-system.html"><a href="the-human-visual-system.html#which-visual-variable-should-i-use"><i class="fa fa-check"></i><b>2.6</b> Which visual variable should I use?</a></li>
<li class="chapter" data-level="2.7" data-path="the-human-visual-system.html"><a href="the-human-visual-system.html#grouping"><i class="fa fa-check"></i><b>2.7</b> Grouping</a></li>
<li class="chapter" data-level="2.8" data-path="the-human-visual-system.html"><a href="the-human-visual-system.html#perceiving-3d"><i class="fa fa-check"></i><b>2.8</b> Perceiving 3D</a></li>
<li class="chapter" data-level="2.9" data-path="the-human-visual-system.html"><a href="the-human-visual-system.html#visual-attention-and-working-memory"><i class="fa fa-check"></i><b>2.9</b> Visual attention and working memory</a></li>
<li class="chapter" data-level="2.10" data-path="the-human-visual-system.html"><a href="the-human-visual-system.html#summary"><i class="fa fa-check"></i><b>2.10</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="visual-communication.html"><a href="visual-communication.html"><i class="fa fa-check"></i><b>3</b> Visual communication</a><ul>
<li class="chapter" data-level="3.1" data-path="visual-communication.html"><a href="visual-communication.html#effective-communication"><i class="fa fa-check"></i><b>3.1</b> Effective communication</a></li>
<li class="chapter" data-level="3.2" data-path="visual-communication.html"><a href="visual-communication.html#narrative-visualisations"><i class="fa fa-check"></i><b>3.2</b> Narrative visualisations</a></li>
<li class="chapter" data-level="3.3" data-path="visual-communication.html"><a href="visual-communication.html#animation-interaction"><i class="fa fa-check"></i><b>3.3</b> Animation &amp; interaction</a></li>
<li class="chapter" data-level="3.4" data-path="visual-communication.html"><a href="visual-communication.html#summary-1"><i class="fa fa-check"></i><b>3.4</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="activity-basic-web-development-skills.html"><a href="activity-basic-web-development-skills.html"><i class="fa fa-check"></i><b>4</b> Activity: Basic web development skills</a><ul>
<li class="chapter" data-level="4.1" data-path="activity-basic-web-development-skills.html"><a href="activity-basic-web-development-skills.html#prepare-the-tools"><i class="fa fa-check"></i><b>4.1</b> Prepare the tools</a></li>
<li class="chapter" data-level="4.2" data-path="activity-basic-web-development-skills.html"><a href="activity-basic-web-development-skills.html#html"><i class="fa fa-check"></i><b>4.2</b> HTML</a></li>
<li class="chapter" data-level="4.3" data-path="activity-basic-web-development-skills.html"><a href="activity-basic-web-development-skills.html#css"><i class="fa fa-check"></i><b>4.3</b> CSS</a></li>
<li class="chapter" data-level="4.4" data-path="activity-basic-web-development-skills.html"><a href="activity-basic-web-development-skills.html#svg"><i class="fa fa-check"></i><b>4.4</b> SVG</a></li>
<li class="chapter" data-level="4.5" data-path="activity-basic-web-development-skills.html"><a href="activity-basic-web-development-skills.html#dom"><i class="fa fa-check"></i><b>4.5</b> DOM</a></li>
<li class="chapter" data-level="4.6" data-path="activity-basic-web-development-skills.html"><a href="activity-basic-web-development-skills.html#javascript"><i class="fa fa-check"></i><b>4.6</b> Javascript</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="activity-creating-visualisations-with-d3.html"><a href="activity-creating-visualisations-with-d3.html"><i class="fa fa-check"></i><b>5</b> Activity: Creating visualisations with D3</a><ul>
<li class="chapter" data-level="5.1" data-path="activity-creating-visualisations-with-d3.html"><a href="activity-creating-visualisations-with-d3.html#an-introduction-to-d3"><i class="fa fa-check"></i><b>5.1</b> An Introduction to D3</a></li>
<li class="chapter" data-level="5.2" data-path="activity-creating-visualisations-with-d3.html"><a href="activity-creating-visualisations-with-d3.html#creating-visualisations-with-d3"><i class="fa fa-check"></i><b>5.2</b> Creating visualisations with D3</a><ul>
<li class="chapter" data-level="" data-path="activity-creating-visualisations-with-d3.html"><a href="activity-creating-visualisations-with-d3.html#a.-drawing-svg-primitives"><i class="fa fa-check"></i>2a. Drawing SVG primitives</a></li>
<li class="chapter" data-level="" data-path="activity-creating-visualisations-with-d3.html"><a href="activity-creating-visualisations-with-d3.html#b.-creating-visualisations-from-data"><i class="fa fa-check"></i>2b. Creating visualisations from data</a></li>
<li class="chapter" data-level="" data-path="activity-creating-visualisations-with-d3.html"><a href="activity-creating-visualisations-with-d3.html#c.-making-a-grouped-bar-chart-with-d3"><i class="fa fa-check"></i>2c. Making a grouped bar chart with D3</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="activity-effective-graphic-design.html"><a href="activity-effective-graphic-design.html"><i class="fa fa-check"></i><b>6</b> Activity: Effective graphic design</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Module 5 Effective data visualisation</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="activity-creating-visualisations-with-d3" class="section level1">
<h1><span class="header-section-number">5</span> Activity: Creating visualisations with D3</h1>
<div id="an-introduction-to-d3" class="section level2">
<h2><span class="header-section-number">5.1</span> An Introduction to D3</h2>
<p>As we already introduced in the preceding <a href="">Activity</a>. D3 is a very powerful Javascript library for creating online interactive visualisations.</p>
<p>We would like to share the visualisations you can create with D3 again: <a href="https://github.com/mbostock/d3/wiki/Gallery" class="uri">https://github.com/mbostock/d3/wiki/Gallery</a> and the free comprehensive <a href="https://alignedleft.com/tutorials/d3">online D3 tutorial</a> by Scott Murray.</p>
<p>Again, you need a text editor for writing the scripts, and you need to figure out a way to access local files (more details in the previous activity).</p>
</div>
<div id="creating-visualisations-with-d3" class="section level2">
<h2><span class="header-section-number">5.2</span> Creating visualisations with D3</h2>
<div id="a.-drawing-svg-primitives" class="section level3 unnumbered">
<h3>2a. Drawing SVG primitives</h3>
<ol style="list-style-type: decimal">
<li>Create a folder to store our files, let’s name it “second”.</li>
<li>Let’s create three files: second.html, second.css, second.js.</li>
<li>We should start with the HTML file, do you still remember how to link css and javascript file in HTML?</li>
</ol>
<pre class="sourceCode html"><code class="sourceCode html"><span class="kw">&lt;html&gt;</span>
    <span class="kw">&lt;head&gt;</span>
        <span class="kw">&lt;title&gt;</span>D3 SVG Primitives<span class="kw">&lt;/title&gt;</span>
        <span class="kw">&lt;link</span><span class="ot"> rel=</span><span class="st">&quot;stylesheet&quot;</span><span class="ot"> href=</span><span class="st">&quot;second.css&quot;</span><span class="kw">&gt;</span>
    <span class="kw">&lt;/head&gt;</span>
    <span class="kw">&lt;body&gt;</span>
        <span class="kw">&lt;svg&gt;&lt;/svg&gt;</span>
        <span class="kw">&lt;script</span><span class="ot"> type=</span><span class="st">&quot;text/javascript&quot;</span><span class="ot"> src=</span><span class="st">&quot;second.js&quot;</span><span class="kw">&gt;&lt;/script&gt;</span>
    <span class="kw">&lt;/body&gt;</span>
<span class="kw">&lt;/html&gt;</span></code></pre>
<ol start="4" style="list-style-type: decimal">
<li>Although it is difficult, now it is the time to start with D3….We should link D3 library first, to make it simple we link to the official online library (alternatively, you can download the javascript library locally and link it):
<br></li>
</ol>
<pre class="sourceCode html"><code class="sourceCode html"><span class="kw">&lt;html&gt;</span>
    <span class="kw">&lt;head&gt;</span>
        <span class="kw">&lt;title&gt;</span>D3 SVG Primitives<span class="kw">&lt;/title&gt;</span>
        <span class="kw">&lt;link</span><span class="ot"> rel=</span><span class="st">&quot;stylesheet&quot;</span><span class="ot"> href=</span><span class="st">&quot;second.css&quot;</span><span class="kw">&gt;</span>
    <span class="kw">&lt;/head&gt;</span>
    <span class="kw">&lt;body&gt;</span>
        <span class="kw">&lt;svg&gt;&lt;/svg&gt;</span>
        
        <span class="kw">&lt;script</span><span class="ot"> src=</span><span class="st">&quot;https://d3js.org/d3.v4.min.js&quot;</span><span class="kw">&gt;&lt;/script&gt;</span>
        <span class="kw">&lt;script</span><span class="ot"> type=</span><span class="st">&quot;text/javascript&quot;</span><span class="ot"> src=</span><span class="st">&quot;second.js&quot;</span><span class="kw">&gt;&lt;/script&gt;</span>
    <span class="kw">&lt;/body&gt;</span>
<span class="kw">&lt;/html&gt;</span></code></pre>
<p>As we need to use D3 in our own script, put D3 library in front of our own script.</p>
<ol start="5" style="list-style-type: decimal">
<li>The preparation is ready, we could start code our own script, open second.js, we should start by creating our own SVG canvas for drawing:</li>
</ol>
<pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="va">window</span>.<span class="at">onload</span> <span class="op">=</span> <span class="kw">function</span>()<span class="op">{</span>
    <span class="kw">var</span> svgCanvas <span class="op">=</span> <span class="va">d3</span>.<span class="at">select</span>(<span class="st">&quot;svg&quot;</span>)
        .<span class="at">attr</span>(<span class="st">&quot;width&quot;</span><span class="op">,</span> <span class="dv">960</span>)
        .<span class="at">attr</span>(<span class="st">&quot;height&quot;</span><span class="op">,</span> <span class="dv">540</span>)<span class="op">;</span>
<span class="op">}</span></code></pre>
<ol start="6" style="list-style-type: decimal">
<li>Open it in the browser (if you are using bracket, open the second.html and click the live preview button)! Nothing special…Well, this is because the canvas is white by default. It is now time to play with CSS (second.css):</li>
</ol>
<pre class="sourceCode css"><code class="sourceCode css"><span class="fu">.svgCanvas</span> {
    <span class="kw">border</span>: <span class="dv">solid</span> <span class="dv">1</span><span class="dt">px</span>
}</code></pre>
<p>Here we added a solid border for the canvas, and we also need to update our Javascript code:</p>
<pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="va">window</span>.<span class="at">onload</span> <span class="op">=</span> <span class="kw">function</span>()<span class="op">{</span>
    <span class="kw">var</span> svgCanvas <span class="op">=</span> <span class="va">d3</span>.<span class="at">select</span>(<span class="st">&quot;svg&quot;</span>)
        .<span class="at">attr</span>(<span class="st">&quot;width&quot;</span><span class="op">,</span> <span class="dv">960</span>)
        .<span class="at">attr</span>(<span class="st">&quot;height&quot;</span><span class="op">,</span> <span class="dv">540</span>)
        .<span class="at">attr</span>(<span class="st">&quot;class&quot;</span><span class="op">,</span> <span class="st">&quot;svgCanvas&quot;</span>)<span class="op">;</span>
<span class="op">}</span></code></pre>
<ol start="7" style="list-style-type: decimal">
<li>We should see a good looking canvas now! Let’s try to draw some primitives (basic shapes) on this canvas, first a rectangle:</li>
</ol>
<pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="va">window</span>.<span class="at">onload</span> <span class="op">=</span> <span class="kw">function</span>()<span class="op">{</span>
    <span class="kw">var</span> svgCanvas <span class="op">=</span> <span class="va">d3</span>.<span class="at">select</span>(<span class="st">&quot;svg&quot;</span>)
        .<span class="at">attr</span>(<span class="st">&quot;width&quot;</span><span class="op">,</span> <span class="dv">960</span>)
        .<span class="at">attr</span>(<span class="st">&quot;height&quot;</span><span class="op">,</span> <span class="dv">540</span>)
        .<span class="at">attr</span>(<span class="st">&quot;class&quot;</span><span class="op">,</span> <span class="st">&quot;svgCanvas&quot;</span>)<span class="op">;</span>
    
    <span class="va">svgCanvas</span>.<span class="at">append</span>(<span class="st">&quot;rect&quot;</span>)
        .<span class="at">attr</span>(<span class="st">&quot;x&quot;</span><span class="op">,</span> <span class="dv">100</span>)
        .<span class="at">attr</span>(<span class="st">&quot;y&quot;</span><span class="op">,</span> <span class="dv">100</span>)
        .<span class="at">attr</span>(<span class="st">&quot;width&quot;</span><span class="op">,</span> <span class="dv">100</span>)
        .<span class="at">attr</span>(<span class="st">&quot;height&quot;</span><span class="op">,</span> <span class="dv">50</span>)<span class="op">;</span>
<span class="op">}</span></code></pre>
<p>Maybe you want it to have rounded-corners:</p>
<pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="va">window</span>.<span class="at">onload</span> <span class="op">=</span> <span class="kw">function</span>()<span class="op">{</span>
    <span class="kw">var</span> svgCanvas <span class="op">=</span> <span class="va">d3</span>.<span class="at">select</span>(<span class="st">&quot;svg&quot;</span>)
        .<span class="at">attr</span>(<span class="st">&quot;width&quot;</span><span class="op">,</span> <span class="dv">960</span>)
        .<span class="at">attr</span>(<span class="st">&quot;height&quot;</span><span class="op">,</span> <span class="dv">540</span>)
        .<span class="at">attr</span>(<span class="st">&quot;class&quot;</span><span class="op">,</span> <span class="st">&quot;svgCanvas&quot;</span>)<span class="op">;</span>
    
    <span class="va">svgCanvas</span>.<span class="at">append</span>(<span class="st">&quot;rect&quot;</span>)
        .<span class="at">attr</span>(<span class="st">&quot;x&quot;</span><span class="op">,</span> <span class="dv">100</span>)
        .<span class="at">attr</span>(<span class="st">&quot;y&quot;</span><span class="op">,</span> <span class="dv">100</span>)
        .<span class="at">attr</span>(<span class="st">&quot;width&quot;</span><span class="op">,</span> <span class="dv">100</span>)
        .<span class="at">attr</span>(<span class="st">&quot;height&quot;</span><span class="op">,</span> <span class="dv">50</span>)
        .<span class="at">attr</span>(<span class="st">&quot;rx&quot;</span><span class="op">,</span> <span class="dv">15</span>)
        .<span class="at">attr</span>(<span class="st">&quot;ry&quot;</span><span class="op">,</span> <span class="dv">10</span>)<span class="op">;</span>
<span class="op">}</span></code></pre>
<p>You can also make it blue:</p>
<pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="va">window</span>.<span class="at">onload</span> <span class="op">=</span> <span class="kw">function</span>()<span class="op">{</span>
    <span class="kw">var</span> svgCanvas <span class="op">=</span> <span class="va">d3</span>.<span class="at">select</span>(<span class="st">&quot;svg&quot;</span>)
        .<span class="at">attr</span>(<span class="st">&quot;width&quot;</span><span class="op">,</span> <span class="dv">960</span>)
        .<span class="at">attr</span>(<span class="st">&quot;height&quot;</span><span class="op">,</span> <span class="dv">540</span>)
        .<span class="at">attr</span>(<span class="st">&quot;class&quot;</span><span class="op">,</span> <span class="st">&quot;svgCanvas&quot;</span>)<span class="op">;</span>
    
    <span class="va">svgCanvas</span>.<span class="at">append</span>(<span class="st">&quot;rect&quot;</span>)
        .<span class="at">attr</span>(<span class="st">&quot;x&quot;</span><span class="op">,</span> <span class="dv">100</span>)
        .<span class="at">attr</span>(<span class="st">&quot;y&quot;</span><span class="op">,</span> <span class="dv">100</span>)
        .<span class="at">attr</span>(<span class="st">&quot;width&quot;</span><span class="op">,</span> <span class="dv">100</span>)
        .<span class="at">attr</span>(<span class="st">&quot;height&quot;</span><span class="op">,</span> <span class="dv">50</span>)
        .<span class="at">attr</span>(<span class="st">&quot;rx&quot;</span><span class="op">,</span> <span class="dv">15</span>)
        .<span class="at">attr</span>(<span class="st">&quot;ry&quot;</span><span class="op">,</span> <span class="dv">10</span>)
        .<span class="at">attr</span>(<span class="st">&quot;fill&quot;</span><span class="op">,</span> <span class="st">&quot;lightblue&quot;</span>)<span class="op">;</span>
<span class="op">}</span></code></pre>
<p>Let’s add a few more shapes (there are more SVG shapes than this example, please refer to the link in the previous SVG section):</p>
<pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="va">window</span>.<span class="at">onload</span> <span class="op">=</span> <span class="kw">function</span>()<span class="op">{</span>
    <span class="kw">var</span> svgCanvas <span class="op">=</span> <span class="va">d3</span>.<span class="at">select</span>(<span class="st">&quot;svg&quot;</span>)
        .<span class="at">attr</span>(<span class="st">&quot;width&quot;</span><span class="op">,</span> <span class="dv">960</span>)
        .<span class="at">attr</span>(<span class="st">&quot;height&quot;</span><span class="op">,</span> <span class="dv">540</span>)
        .<span class="at">attr</span>(<span class="st">&quot;class&quot;</span><span class="op">,</span> <span class="st">&quot;svgCanvas&quot;</span>)<span class="op">;</span>
    
    <span class="va">svgCanvas</span>.<span class="at">append</span>(<span class="st">&quot;rect&quot;</span>)
        .<span class="at">attr</span>(<span class="st">&quot;x&quot;</span><span class="op">,</span> <span class="dv">100</span>)
        .<span class="at">attr</span>(<span class="st">&quot;y&quot;</span><span class="op">,</span> <span class="dv">100</span>)
        .<span class="at">attr</span>(<span class="st">&quot;width&quot;</span><span class="op">,</span> <span class="dv">100</span>)
        .<span class="at">attr</span>(<span class="st">&quot;height&quot;</span><span class="op">,</span> <span class="dv">50</span>)
        .<span class="at">attr</span>(<span class="st">&quot;rx&quot;</span><span class="op">,</span> <span class="dv">15</span>)
        .<span class="at">attr</span>(<span class="st">&quot;ry&quot;</span><span class="op">,</span> <span class="dv">10</span>)
        .<span class="at">attr</span>(<span class="st">&quot;fill&quot;</span><span class="op">,</span> <span class="st">&quot;lightblue&quot;</span>)<span class="op">;</span>
    
    <span class="va">svgCanvas</span>.<span class="at">append</span>(<span class="st">&quot;circle&quot;</span>)
        .<span class="at">attr</span>(<span class="st">&quot;cx&quot;</span><span class="op">,</span> <span class="dv">300</span>)
        .<span class="at">attr</span>(<span class="st">&quot;cy&quot;</span><span class="op">,</span> <span class="dv">200</span>)
        .<span class="at">attr</span>(<span class="st">&quot;r&quot;</span><span class="op">,</span> <span class="dv">30</span>)
        .<span class="at">attr</span>(<span class="st">&quot;fill&quot;</span><span class="op">,</span> <span class="st">&quot;lightgreen&quot;</span>)<span class="op">;</span>
    
    <span class="va">svgCanvas</span>.<span class="at">append</span>(<span class="st">&quot;ellipse&quot;</span>)
        .<span class="at">attr</span>(<span class="st">&quot;cx&quot;</span><span class="op">,</span> <span class="dv">300</span>)
        .<span class="at">attr</span>(<span class="st">&quot;cy&quot;</span><span class="op">,</span> <span class="dv">400</span>)
        .<span class="at">attr</span>(<span class="st">&quot;rx&quot;</span><span class="op">,</span> <span class="dv">30</span>)
        .<span class="at">attr</span>(<span class="st">&quot;ry&quot;</span><span class="op">,</span> <span class="dv">60</span>)
        .<span class="at">attr</span>(<span class="st">&quot;fill&quot;</span><span class="op">,</span> <span class="st">&quot;lightgreen&quot;</span>)<span class="op">;</span>
    
    <span class="va">svgCanvas</span>.<span class="at">append</span>(<span class="st">&quot;line&quot;</span>)
        .<span class="at">attr</span>(<span class="st">&quot;x1&quot;</span><span class="op">,</span> <span class="dv">300</span>)
        .<span class="at">attr</span>(<span class="st">&quot;y1&quot;</span><span class="op">,</span> <span class="dv">400</span>)
        .<span class="at">attr</span>(<span class="st">&quot;x2&quot;</span><span class="op">,</span> <span class="dv">300</span>)
        .<span class="at">attr</span>(<span class="st">&quot;y2&quot;</span><span class="op">,</span> <span class="dv">200</span>)
        .<span class="at">attr</span>(<span class="st">&quot;stroke&quot;</span><span class="op">,</span> <span class="st">&quot;black&quot;</span>)<span class="op">;</span>
<span class="op">}</span></code></pre>
<p>Technically, all visualisations are made by those primitives, so once you know how to create primitives, you are already able to create all visualisations with D3.</p>
</div>
<div id="b.-creating-visualisations-from-data" class="section level3 unnumbered">
<h3>2b. Creating visualisations from data</h3>
<p>D3 is actually short for <em>Data Driven Document</em>. Obviously it means Data plays an important role in creating visualisations. Let’s create a simple visualisation based on some data.</p>
<ol style="list-style-type: decimal">
<li>Create a folder to store our files, let’s name it “third”.</li>
<li>Let’s create three files:third.html, third.css, third.js.</li>
<li>Edit the third.html with:</li>
</ol>
<pre class="sourceCode html"><code class="sourceCode html"><span class="kw">&lt;html&gt;</span>
    <span class="kw">&lt;head&gt;</span>
        <span class="kw">&lt;title&gt;</span>Creating visualisations from data<span class="kw">&lt;/title&gt;</span>
        <span class="kw">&lt;link</span><span class="ot"> rel=</span><span class="st">&quot;stylesheet&quot;</span><span class="ot"> href=</span><span class="st">&quot;third.css&quot;</span><span class="kw">&gt;</span>
    <span class="kw">&lt;/head&gt;</span>
    <span class="kw">&lt;body&gt;</span>
        <span class="kw">&lt;svg&gt;&lt;/svg&gt;</span>
        
        <span class="kw">&lt;script</span><span class="ot"> src=</span><span class="st">&quot;https://d3js.org/d3.v4.min.js&quot;</span><span class="kw">&gt;&lt;/script&gt;</span>
        <span class="kw">&lt;script</span><span class="ot"> type=</span><span class="st">&quot;text/javascript&quot;</span><span class="ot"> src=</span><span class="st">&quot;third.js&quot;</span><span class="kw">&gt;&lt;/script&gt;</span>
    <span class="kw">&lt;/body&gt;</span>
<span class="kw">&lt;/html&gt;</span></code></pre>
<ol start="4" style="list-style-type: decimal">
<li>Download our <a href="diagrams_datasets/section5/third.csv">data</a> to the same folder.</li>
<li>Now we can start loading the data with D3, D3 provide functions to load data in variety of formats, we will use d3.csv to load our data (in third.js):</li>
</ol>
<pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="va">window</span>.<span class="at">onload</span> <span class="op">=</span> <span class="kw">function</span>()<span class="op">{</span>
    <span class="va">d3</span>.<span class="at">csv</span>(<span class="st">&quot;third.csv&quot;</span><span class="op">,</span> <span class="kw">function</span>(d)<span class="op">{</span>
        <span class="va">console</span>.<span class="at">log</span>(d)<span class="op">;</span> 
    <span class="op">}</span>)<span class="op">;</span>
<span class="op">}</span></code></pre>
<p>If you are using brackets, open the third.html file and click the live preview button.</p>
<ol start="6" style="list-style-type: decimal">
<li>We want to have a look at whether we loaded the correct data, so we print the detailed data in the console, now we can open the console to have a look (still remember the way to open developer tools in Chrome?), we should have:</li>
</ol>
<p><img src="diagrams_datasets/section5/d3-05.png" /></p>
<p>We exactly had our values.</p>
<ol start="7" style="list-style-type: decimal">
<li>Let’s set up our canvas and start drawing (do not to have the svgCanvas class in your CSS file):</li>
</ol>
<pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="va">window</span>.<span class="at">onload</span> <span class="op">=</span> <span class="kw">function</span>()<span class="op">{</span>
    <span class="kw">var</span> svgCanvas <span class="op">=</span> <span class="va">d3</span>.<span class="at">select</span>(<span class="st">&quot;svg&quot;</span>)
        .<span class="at">attr</span>(<span class="st">&quot;width&quot;</span><span class="op">,</span> <span class="dv">960</span>)
        .<span class="at">attr</span>(<span class="st">&quot;height&quot;</span><span class="op">,</span> <span class="dv">540</span>)
        .<span class="at">attr</span>(<span class="st">&quot;class&quot;</span><span class="op">,</span> <span class="st">&quot;svgCanvas&quot;</span>)<span class="op">;</span>
    
    <span class="va">d3</span>.<span class="at">csv</span>(<span class="st">&quot;third.csv&quot;</span><span class="op">,</span> <span class="kw">function</span>(d)<span class="op">{</span>
        <span class="va">console</span>.<span class="at">log</span>(d)<span class="op">;</span> 
        
        <span class="va">svgCanvas</span>.<span class="at">selectAll</span>(<span class="st">&quot;circle&quot;</span>)
            .<span class="at">data</span>(d).<span class="at">enter</span>() <span class="co">// create place hodlers if the data are new</span>
            .<span class="at">append</span>(<span class="st">&quot;circle&quot;</span>) <span class="co">// create one circle for each</span>
            .<span class="at">attr</span>(<span class="st">&quot;cx&quot;</span><span class="op">,</span> <span class="kw">function</span>(thisElement<span class="op">,</span> index)<span class="op">{</span> <span class="co">// calculate the centres of circles </span>
                <span class="cf">return</span> <span class="dv">150</span> <span class="op">+</span> index <span class="op">*</span> <span class="dv">150</span><span class="op">;</span>
            <span class="op">}</span>)
            .<span class="at">attr</span>(<span class="st">&quot;cy&quot;</span><span class="op">,</span> <span class="dv">300</span>)
            .<span class="at">attr</span>(<span class="st">&quot;r&quot;</span><span class="op">,</span> <span class="kw">function</span>(thisElement<span class="op">,</span> index)<span class="op">{</span> <span class="co">// use the value from data to create the radius </span>
                <span class="cf">return</span> thisElement[<span class="st">&quot;value&quot;</span>]<span class="op">;</span>
            <span class="op">}</span>)<span class="op">;</span>
        
    <span class="op">}</span>)<span class="op">;</span>
<span class="op">}</span></code></pre>
<p><code>selectAll(“circle”).data(d).enter()</code> is absolutely the magic function here. Basically it build a link between the HTML elements and the data. <code>selectAll</code> select the HTML element, and <code>data</code> link the html elements with the data. More details at: <a href="http://techtime.getharvest.com/blog/understanding-d3-selection-operations" class="uri">http://techtime.getharvest.com/blog/understanding-d3-selection-operations</a></p>
<ol start="8" style="list-style-type: decimal">
<li>Let’s make it a bit more informative (still remember the way we make play around with color in the first week’s D3 activity), do not forget to link the color library we use:</li>
</ol>
<pre class="sourceCode html"><code class="sourceCode html"><span class="kw">&lt;html&gt;</span>
    <span class="kw">&lt;head&gt;</span>
        <span class="kw">&lt;title&gt;</span>Creating visualisations from data<span class="kw">&lt;/title&gt;</span>
        <span class="kw">&lt;link</span><span class="ot"> rel=</span><span class="st">&quot;stylesheet&quot;</span><span class="ot"> href=</span><span class="st">&quot;third.css&quot;</span><span class="kw">&gt;</span>
    <span class="kw">&lt;/head&gt;</span>
    <span class="kw">&lt;body&gt;</span>
        <span class="kw">&lt;svg&gt;&lt;/svg&gt;</span>
        
        <span class="kw">&lt;script</span><span class="ot"> src=</span><span class="st">&quot;https://d3js.org/d3.v4.min.js&quot;</span><span class="kw">&gt;&lt;/script&gt;</span>
        <span class="kw">&lt;script</span><span class="ot"> src=</span><span class="st">&quot;https://d3js.org/d3-scale-chromatic.v1.min.js&quot;</span><span class="kw">&gt;&lt;/script&gt;</span>
        <span class="kw">&lt;script</span><span class="ot"> type=</span><span class="st">&quot;text/javascript&quot;</span><span class="ot"> src=</span><span class="st">&quot;third.js&quot;</span><span class="kw">&gt;&lt;/script&gt;</span>
    <span class="kw">&lt;/body&gt;</span>
<span class="kw">&lt;/html&gt;</span></code></pre>
<p>Now, we can make it colorful and also with some text there.</p>
<pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="va">window</span>.<span class="at">onload</span> <span class="op">=</span> <span class="kw">function</span>()<span class="op">{</span>
    <span class="kw">var</span> svgCanvas <span class="op">=</span> <span class="va">d3</span>.<span class="at">select</span>(<span class="st">&quot;svg&quot;</span>)
        .<span class="at">attr</span>(<span class="st">&quot;width&quot;</span><span class="op">,</span> <span class="dv">960</span>)
        .<span class="at">attr</span>(<span class="st">&quot;height&quot;</span><span class="op">,</span> <span class="dv">540</span>)
        .<span class="at">attr</span>(<span class="st">&quot;class&quot;</span><span class="op">,</span> <span class="st">&quot;svgCanvas&quot;</span>)<span class="op">;</span>
    
    <span class="va">d3</span>.<span class="at">csv</span>(<span class="st">&quot;third.csv&quot;</span><span class="op">,</span> <span class="kw">function</span>(d)<span class="op">{</span>
        <span class="va">console</span>.<span class="at">log</span>(d)<span class="op">;</span> 
        
        <span class="kw">var</span> minValue <span class="op">=</span> <span class="kw">Infinity</span><span class="op">;</span>
        <span class="kw">var</span> maxValue <span class="op">=</span> <span class="dv">-1</span><span class="op">;</span>
        <span class="va">d</span>.<span class="at">forEach</span>(<span class="kw">function</span>(thisD)<span class="op">{</span>
            <span class="kw">var</span> thisValue <span class="op">=</span> thisD[<span class="st">&quot;value&quot;</span>]<span class="op">;</span>
            minValue <span class="op">=</span> <span class="va">Math</span>.<span class="at">min</span>(minValue<span class="op">,</span> thisValue)<span class="op">;</span>
            maxValue <span class="op">=</span> <span class="va">Math</span>.<span class="at">max</span>(maxValue<span class="op">,</span> thisValue)<span class="op">;</span>
        <span class="op">}</span>)<span class="op">;</span>
        
        <span class="kw">var</span> value2range <span class="op">=</span> <span class="va">d3</span>.<span class="at">scaleLinear</span>()
            .<span class="at">domain</span>([minValue<span class="op">,</span> maxValue])
            .<span class="at">range</span>([<span class="fl">0.5</span><span class="op">,</span> <span class="dv">1</span>])<span class="op">;</span>
        <span class="kw">var</span> range2color <span class="op">=</span> <span class="va">d3</span>.<span class="at">interpolateBlues</span><span class="op">;</span>
        
        <span class="va">svgCanvas</span>.<span class="at">selectAll</span>(<span class="st">&quot;circle&quot;</span>)
            .<span class="at">data</span>(d).<span class="at">enter</span>() <span class="co">// create place hodlers if the data are new</span>
            .<span class="at">append</span>(<span class="st">&quot;circle&quot;</span>) <span class="co">// create one circle for each</span>
            .<span class="at">attr</span>(<span class="st">&quot;cx&quot;</span><span class="op">,</span> <span class="kw">function</span>(thisElement<span class="op">,</span> index)<span class="op">{</span> <span class="co">// calculate the centres of circles </span>
                <span class="cf">return</span> <span class="dv">150</span> <span class="op">+</span> index <span class="op">*</span> <span class="dv">150</span><span class="op">;</span>
            <span class="op">}</span>)
            .<span class="at">attr</span>(<span class="st">&quot;cy&quot;</span><span class="op">,</span> <span class="dv">300</span>)
            .<span class="at">attr</span>(<span class="st">&quot;r&quot;</span><span class="op">,</span> <span class="kw">function</span>(thisElement<span class="op">,</span> index)<span class="op">{</span> <span class="co">// use the value from data to create the radius </span>
                <span class="cf">return</span> thisElement[<span class="st">&quot;value&quot;</span>]<span class="op">;</span>
            <span class="op">}</span>)
            .<span class="at">attr</span>(<span class="st">&quot;fill&quot;</span><span class="op">,</span> <span class="kw">function</span>(thisElement<span class="op">,</span> index)<span class="op">{</span>
                <span class="cf">return</span> <span class="at">range2color</span>(<span class="at">value2range</span>(thisElement[<span class="st">&quot;value&quot;</span>]))
            <span class="op">}</span>)<span class="op">;</span>
        
        <span class="va">svgCanvas</span>.<span class="at">selectAll</span>(<span class="st">&quot;text&quot;</span>)
            .<span class="at">data</span>(d).<span class="at">enter</span>()
            .<span class="at">append</span>(<span class="st">&quot;text&quot;</span>)
            .<span class="at">attr</span>(<span class="st">&quot;x&quot;</span><span class="op">,</span> <span class="kw">function</span>(thisElement<span class="op">,</span> index)<span class="op">{</span>
                <span class="cf">return</span> <span class="dv">150</span> <span class="op">+</span> index <span class="op">*</span> <span class="dv">150</span><span class="op">;</span>
            <span class="op">}</span>)
            .<span class="at">attr</span>(<span class="st">&quot;y&quot;</span><span class="op">,</span> <span class="dv">300</span> <span class="op">-</span> <span class="dv">35</span>)
            .<span class="at">attr</span>(<span class="st">&quot;text-anchor&quot;</span><span class="op">,</span> <span class="st">&quot;middle&quot;</span>)
            .<span class="at">text</span>(<span class="kw">function</span>(thisElement<span class="op">,</span> index)<span class="op">{</span>
                <span class="cf">return</span> thisElement[<span class="st">&quot;title&quot;</span>] <span class="op">+</span> <span class="st">&quot;: &quot;</span> <span class="op">+</span> thisElement[<span class="st">&quot;value&quot;</span>]<span class="op">;</span>
            <span class="op">}</span>)<span class="op">;</span>
        
    <span class="op">}</span>)<span class="op">;</span>
<span class="op">}</span></code></pre>
<ol start="9" style="list-style-type: decimal">
<li>Let’s add some interactions:</li>
</ol>
<pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="va">window</span>.<span class="at">onload</span> <span class="op">=</span> <span class="kw">function</span>()<span class="op">{</span>
    <span class="kw">var</span> svgCanvas <span class="op">=</span> <span class="va">d3</span>.<span class="at">select</span>(<span class="st">&quot;svg&quot;</span>)
        .<span class="at">attr</span>(<span class="st">&quot;width&quot;</span><span class="op">,</span> <span class="dv">960</span>)
        .<span class="at">attr</span>(<span class="st">&quot;height&quot;</span><span class="op">,</span> <span class="dv">540</span>)
        .<span class="at">attr</span>(<span class="st">&quot;class&quot;</span><span class="op">,</span> <span class="st">&quot;svgCanvas&quot;</span>)<span class="op">;</span>
    
    <span class="va">d3</span>.<span class="at">csv</span>(<span class="st">&quot;third.csv&quot;</span><span class="op">,</span> <span class="kw">function</span>(d)<span class="op">{</span>
        <span class="va">console</span>.<span class="at">log</span>(d)<span class="op">;</span> 
        
        <span class="kw">var</span> minValue <span class="op">=</span> <span class="kw">Infinity</span><span class="op">;</span>
        <span class="kw">var</span> maxValue <span class="op">=</span> <span class="dv">-1</span><span class="op">;</span>
        <span class="va">d</span>.<span class="at">forEach</span>(<span class="kw">function</span>(thisD)<span class="op">{</span>
            <span class="kw">var</span> thisValue <span class="op">=</span> thisD[<span class="st">&quot;value&quot;</span>]<span class="op">;</span>
            minValue <span class="op">=</span> <span class="va">Math</span>.<span class="at">min</span>(minValue<span class="op">,</span> thisValue)<span class="op">;</span>
            maxValue <span class="op">=</span> <span class="va">Math</span>.<span class="at">max</span>(maxValue<span class="op">,</span> thisValue)<span class="op">;</span>
        <span class="op">}</span>)<span class="op">;</span>
        
        <span class="kw">var</span> value2range <span class="op">=</span> <span class="va">d3</span>.<span class="at">scaleLinear</span>()
            .<span class="at">domain</span>([minValue<span class="op">,</span> maxValue])
            .<span class="at">range</span>([<span class="fl">0.5</span><span class="op">,</span> <span class="dv">1</span>])<span class="op">;</span>
        <span class="kw">var</span> range2color <span class="op">=</span> <span class="va">d3</span>.<span class="at">interpolateBlues</span><span class="op">;</span>
        
        <span class="va">svgCanvas</span>.<span class="at">selectAll</span>(<span class="st">&quot;circle&quot;</span>)
            .<span class="at">data</span>(d).<span class="at">enter</span>() <span class="co">// create place hodlers if the data are new</span>
            .<span class="at">append</span>(<span class="st">&quot;circle&quot;</span>) <span class="co">// create one circle for each</span>
            <span class="co">// calculate the centres of circles </span>
            .<span class="at">attr</span>(<span class="st">&quot;cx&quot;</span><span class="op">,</span> <span class="kw">function</span>(thisElement<span class="op">,</span> index)<span class="op">{</span> 
                <span class="cf">return</span> <span class="dv">150</span> <span class="op">+</span> index <span class="op">*</span> <span class="dv">150</span><span class="op">;</span>
            <span class="op">}</span>)
            .<span class="at">attr</span>(<span class="st">&quot;cy&quot;</span><span class="op">,</span> <span class="dv">300</span>)
            <span class="co">// use the value from data to create the radius</span>
            .<span class="at">attr</span>(<span class="st">&quot;r&quot;</span><span class="op">,</span> <span class="kw">function</span>(thisElement<span class="op">,</span> index)<span class="op">{</span>  
                <span class="cf">return</span> thisElement[<span class="st">&quot;value&quot;</span>]<span class="op">;</span>
            <span class="op">}</span>)
            .<span class="at">attr</span>(<span class="st">&quot;fill&quot;</span><span class="op">,</span> <span class="kw">function</span>(thisElement<span class="op">,</span> index)<span class="op">{</span>
                <span class="cf">return</span> <span class="at">range2color</span>(<span class="at">value2range</span>(thisElement[<span class="st">&quot;value&quot;</span>]))
            <span class="op">}</span>)
            .<span class="at">on</span>(<span class="st">&quot;mouseover&quot;</span><span class="op">,</span> <span class="kw">function</span>(thisElement<span class="op">,</span> index)<span class="op">{</span>
                <span class="va">svgCanvas</span>.<span class="at">selectAll</span>(<span class="st">&quot;circle&quot;</span>)
                    .<span class="at">attr</span>(<span class="st">&quot;opacity&quot;</span><span class="op">,</span> <span class="fl">0.5</span>)<span class="op">;</span> <span class="co">// grey out all circles</span>
                <span class="va">d3</span>.<span class="at">select</span>(<span class="kw">this</span>) <span class="co">// hightlight the on hovering on</span>
                    .<span class="at">attr</span>(<span class="st">&quot;opacity&quot;</span><span class="op">,</span> <span class="dv">1</span>)<span class="op">;</span>
            <span class="op">}</span>)
            .<span class="at">on</span>(<span class="st">&quot;mouseout&quot;</span><span class="op">,</span> <span class="kw">function</span>(thisElement<span class="op">,</span> index)<span class="op">{</span>
              <span class="co">// restore all circles to normal mode</span>
                <span class="va">svgCanvas</span>.<span class="at">selectAll</span>(<span class="st">&quot;circle&quot;</span>) 
                    .<span class="at">attr</span>(<span class="st">&quot;opacity&quot;</span><span class="op">,</span> <span class="dv">1</span>)<span class="op">;</span>
            <span class="op">}</span>)<span class="op">;</span>
        
        <span class="va">svgCanvas</span>.<span class="at">selectAll</span>(<span class="st">&quot;text&quot;</span>)
            .<span class="at">data</span>(d).<span class="at">enter</span>()
            .<span class="at">append</span>(<span class="st">&quot;text&quot;</span>)
            .<span class="at">attr</span>(<span class="st">&quot;x&quot;</span><span class="op">,</span> <span class="kw">function</span>(thisElement<span class="op">,</span> index)<span class="op">{</span>
                <span class="cf">return</span> <span class="dv">150</span> <span class="op">+</span> index <span class="op">*</span> <span class="dv">150</span><span class="op">;</span>
            <span class="op">}</span>)
            .<span class="at">attr</span>(<span class="st">&quot;y&quot;</span><span class="op">,</span> <span class="dv">300</span> <span class="op">-</span> <span class="dv">35</span>)
            .<span class="at">attr</span>(<span class="st">&quot;text-anchor&quot;</span><span class="op">,</span> <span class="st">&quot;middle&quot;</span>)
            .<span class="at">text</span>(<span class="kw">function</span>(thisElement<span class="op">,</span> index)<span class="op">{</span>
                <span class="cf">return</span> thisElement[<span class="st">&quot;title&quot;</span>] <span class="op">+</span> <span class="st">&quot;: &quot;</span> <span class="op">+</span> thisElement[<span class="st">&quot;value&quot;</span>]<span class="op">;</span>
            <span class="op">}</span>)<span class="op">;</span>
        
    <span class="op">}</span>)<span class="op">;</span>
<span class="op">}</span></code></pre>
</div>
<div id="c.-making-a-grouped-bar-chart-with-d3" class="section level3 unnumbered">
<h3>2c. Making a grouped bar chart with D3</h3>
<p>In theory, you should be able to create any visualisation you can imagine with D3 now.</p>
<p>However, it also seems a lot of work needs to be done to create a “normal” visualisation, like a bar chart.</p>
<p>Actually, there are lots of help functions from D3 to help you with this process.</p>
<p>We will show you an example of creating bar charts with D3.</p>
<p>Download our <a href="diagrams_datasets/section5/fourth.csv">data</a> first. To make thing easier and also as an example, we have all the files (css, javascript, html) in one file, we can name it fourth.html:</p>
<pre class="sourceCode html"><code class="sourceCode html"><span class="kw">&lt;html&gt;</span>
    <span class="kw">&lt;head&gt;</span>
        <span class="kw">&lt;title&gt;</span>Grouped bar chart in D3<span class="kw">&lt;/title&gt;</span>
        <span class="kw">&lt;style&gt;</span>
            <span class="fu">.svgCanvas</span> {
                <span class="kw">border</span>: <span class="dv">solid</span> <span class="dv">1</span><span class="dt">px</span>
            }
        <span class="kw">&lt;/style&gt;</span>
    <span class="kw">&lt;/head&gt;</span>
    <span class="kw">&lt;body&gt;</span>
        <span class="kw">&lt;svg&gt;&lt;/svg&gt;</span>
        
        <span class="kw">&lt;script</span><span class="ot"> src=</span><span class="st">&quot;https://d3js.org/d3.v4.min.js&quot;</span><span class="kw">&gt;&lt;/script&gt;</span>
        <span class="kw">&lt;script&gt;</span>
            <span class="va">window</span>.<span class="at">onload</span> <span class="op">=</span> <span class="kw">function</span>()<span class="op">{</span>
                <span class="co">// Canvas width and height</span>
                <span class="kw">var</span> width <span class="op">=</span> <span class="dv">600</span><span class="op">;</span>
                <span class="kw">var</span> height <span class="op">=</span> <span class="dv">300</span><span class="op">;</span>
                
                <span class="co">// Create a SVG canvas</span>
                <span class="kw">var</span> thisCanvas <span class="op">=</span> <span class="va">d3</span>.<span class="at">select</span>(<span class="st">&quot;svg&quot;</span>)
                    .<span class="at">attr</span>(<span class="st">&quot;width&quot;</span><span class="op">,</span> width)
                    .<span class="at">attr</span>(<span class="st">&quot;height&quot;</span><span class="op">,</span> height)
                    .<span class="at">attr</span>(<span class="st">&quot;class&quot;</span><span class="op">,</span> <span class="st">&quot;svgCanvas&quot;</span>)<span class="op">;</span>
                
                <span class="co">// We want some margin between the boundary of the canvas and the bar charts</span>
                <span class="kw">var</span> margin <span class="op">=</span> <span class="op">{</span><span class="dt">top</span><span class="op">:</span> <span class="dv">10</span><span class="op">,</span> <span class="dt">right</span><span class="op">:</span> <span class="dv">20</span><span class="op">,</span> <span class="dt">bottom</span><span class="op">:</span> <span class="dv">30</span><span class="op">,</span> <span class="dt">left</span><span class="op">:</span> <span class="dv">50</span><span class="op">};</span>
                width <span class="op">=</span> width <span class="op">-</span> <span class="va">margin</span>.<span class="at">left</span> <span class="op">-</span> <span class="va">margin</span>.<span class="at">right</span><span class="op">;</span>
                height <span class="op">=</span> height <span class="op">-</span> <span class="va">margin</span>.<span class="at">top</span> <span class="op">-</span> <span class="va">margin</span>.<span class="at">bottom</span><span class="op">;</span>
                
                <span class="co">// create the area to draw the bar chart</span>
                <span class="co">// g is a SVG element to group multiple SVG elements</span>
                <span class="kw">var</span> barChartArea <span class="op">=</span> thisCanvas
                    .<span class="at">append</span>(<span class="st">&quot;g&quot;</span>)
                    .<span class="at">attr</span>(<span class="st">&quot;transform&quot;</span><span class="op">,</span> <span class="st">&quot;translate(&quot;</span> <span class="op">+</span> <span class="va">margin</span>.<span class="at">left</span> <span class="op">+</span> <span class="st">&quot;,&quot;</span> <span class="op">+</span> <span class="va">margin</span>.<span class="at">top</span> <span class="op">+</span> <span class="st">&quot;)&quot;</span>)<span class="op">;</span>
                
                <span class="co">// Set up a helpr function to divide x axis</span>
                <span class="kw">var</span> x0 <span class="op">=</span> <span class="va">d3</span>.<span class="at">scaleBand</span>()
                    .<span class="at">rangeRound</span>([<span class="dv">0</span><span class="op">,</span> width])
                    .<span class="at">paddingInner</span>(<span class="fl">0.2</span>)<span class="op">;</span> <span class="co">// padding between different groups</span>
                
                <span class="co">// two property for each group</span>
                <span class="kw">var</span> keys <span class="op">=</span> [<span class="st">&quot;income&quot;</span><span class="op">,</span> <span class="st">&quot;spend&quot;</span>]<span class="op">;</span>
                <span class="co">// Set up a helpr function to divide x axis **within** a group</span>
                <span class="kw">var</span> x1 <span class="op">=</span> <span class="va">d3</span>.<span class="at">scaleBand</span>()
                    .<span class="at">padding</span>(<span class="fl">0.1</span>)<span class="op">;</span> <span class="co">// padding between different properties within a group</span>
                
                <span class="co">// helper function to calculate the height of each bar</span>
                <span class="kw">var</span> y <span class="op">=</span> <span class="va">d3</span>.<span class="at">scaleLinear</span>()
                    .<span class="at">rangeRound</span>([height<span class="op">,</span> <span class="dv">0</span>])<span class="op">;</span>
                
                <span class="va">d3</span>.<span class="at">csv</span>(<span class="st">&quot;fourth.csv&quot;</span><span class="op">,</span> <span class="kw">function</span>(data)<span class="op">{</span>
                    <span class="va">console</span>.<span class="at">log</span>(data)<span class="op">;</span> 
                    
                    <span class="co">// for differetn groups</span>
                    <span class="va">x0</span>.<span class="at">domain</span>(<span class="va">data</span>.<span class="at">map</span>(<span class="kw">function</span>(d) <span class="op">{</span> <span class="cf">return</span> d[<span class="st">&#39;name&#39;</span>]<span class="op">;</span> <span class="op">}</span>))<span class="op">;</span>
                    <span class="co">// for properties within a group</span>
                    <span class="va">x1</span>.<span class="at">domain</span>(keys).<span class="at">rangeRound</span>([<span class="dv">0</span><span class="op">,</span> <span class="va">x0</span>.<span class="at">bandwidth</span>()])<span class="op">;</span>
                    <span class="co">// for bar height</span>
                    <span class="va">y</span>.<span class="at">domain</span>([<span class="dv">0</span><span class="op">,</span> <span class="va">d3</span>.<span class="at">max</span>(data<span class="op">,</span> <span class="kw">function</span>(d) <span class="op">{</span>
                        <span class="cf">return</span> <span class="va">d3</span>.<span class="at">max</span>(keys<span class="op">,</span> <span class="kw">function</span>(key) <span class="op">{</span>
                            <span class="cf">return</span> <span class="at">parseInt</span>(d[key])<span class="op">;</span> 
                        <span class="op">}</span>)<span class="op">;</span> 
                    <span class="op">}</span>)])<span class="op">;</span>
                    
                    
                    <span class="va">barChartArea</span>.<span class="at">append</span>(<span class="st">&quot;g&quot;</span>)
                        .<span class="at">selectAll</span>(<span class="st">&quot;g&quot;</span>)
                        .<span class="at">data</span>(data)
                        .<span class="at">enter</span>().<span class="at">append</span>(<span class="st">&quot;g&quot;</span>)
                        <span class="co">// create groups</span>
                        .<span class="at">attr</span>(<span class="st">&quot;transform&quot;</span><span class="op">,</span> <span class="kw">function</span>(d) <span class="op">{</span> 
                          <span class="cf">return</span> <span class="st">&quot;translate(&quot;</span> <span class="op">+</span> <span class="at">x0</span>(d[<span class="st">&quot;name&quot;</span>]) <span class="op">+</span> <span class="st">&quot;,0)&quot;</span><span class="op">;</span> 
                          <span class="op">}</span>)
                        .<span class="at">selectAll</span>(<span class="st">&quot;rect&quot;</span>)
                        <span class="co">// pre-processing the data</span>
                        .<span class="at">data</span>(<span class="kw">function</span>(d) <span class="op">{</span>
                            <span class="cf">return</span> <span class="va">keys</span>.<span class="at">map</span>(<span class="kw">function</span>(key) <span class="op">{</span>
                                <span class="cf">return</span> <span class="op">{</span>
                                    <span class="dt">key</span><span class="op">:</span> key<span class="op">,</span>
                                    <span class="dt">value</span><span class="op">:</span> d[key]<span class="op">,</span>
                                    <span class="dt">name</span><span class="op">:</span> d[<span class="st">&quot;name&quot;</span>]
                                <span class="op">};</span>
                            <span class="op">}</span>)<span class="op">;</span>
                        <span class="op">}</span>)
                        .<span class="at">enter</span>().<span class="at">append</span>(<span class="st">&quot;rect&quot;</span>)
                        <span class="co">// start drawing bars for each property and each group</span>
                        .<span class="at">attr</span>(<span class="st">&quot;x&quot;</span><span class="op">,</span> <span class="kw">function</span>(d) <span class="op">{</span> 
                            <span class="cf">return</span> <span class="at">x1</span>(d[<span class="st">&quot;key&quot;</span>])<span class="op">;</span> 
                        <span class="op">}</span>)
                        .<span class="at">attr</span>(<span class="st">&quot;y&quot;</span><span class="op">,</span> <span class="kw">function</span>(d) <span class="op">{</span>
                            <span class="cf">return</span> <span class="at">y</span>(d[<span class="st">&quot;value&quot;</span>])<span class="op">;</span> 
                        <span class="op">}</span>)
                        .<span class="at">attr</span>(<span class="st">&quot;width&quot;</span><span class="op">,</span> <span class="va">x1</span>.<span class="at">bandwidth</span>())
                        .<span class="at">attr</span>(<span class="st">&quot;height&quot;</span><span class="op">,</span> <span class="kw">function</span>(d) <span class="op">{</span> <span class="cf">return</span> height <span class="op">-</span> <span class="at">y</span>(d[<span class="st">&quot;value&quot;</span>])<span class="op">;</span> <span class="op">}</span>)
                        .<span class="at">attr</span>(<span class="st">&quot;fill&quot;</span><span class="op">,</span> <span class="kw">function</span>(d) <span class="op">{</span>
                            <span class="cf">if</span>(d[<span class="st">&quot;key&quot;</span>] <span class="op">===</span> <span class="st">&quot;income&quot;</span>)
                            <span class="op">{</span>
                                <span class="cf">return</span> <span class="st">&quot;lightgreen&quot;</span><span class="op">;</span>
                            <span class="op">}</span>
                            <span class="cf">else</span> <span class="cf">if</span>(d[<span class="st">&quot;key&quot;</span>] <span class="op">===</span> <span class="st">&quot;spend&quot;</span>)
                            <span class="op">{</span>
                                <span class="cf">return</span> <span class="st">&quot;red&quot;</span><span class="op">;</span>
                            <span class="op">}</span>
                        <span class="op">}</span>)<span class="op">;</span>
                    
                    <span class="co">// add x axis with ticks</span>
                    <span class="va">barChartArea</span>.<span class="at">append</span>(<span class="st">&quot;g&quot;</span>)
                        .<span class="at">attr</span>(<span class="st">&quot;class&quot;</span><span class="op">,</span> <span class="st">&quot;axis&quot;</span>)
                        .<span class="at">attr</span>(<span class="st">&quot;transform&quot;</span><span class="op">,</span> <span class="st">&quot;translate(0,&quot;</span> <span class="op">+</span> height <span class="op">+</span> <span class="st">&quot;)&quot;</span>)
                        .<span class="at">call</span>(<span class="va">d3</span>.<span class="at">axisBottom</span>(x0))<span class="op">;</span>
                    
                    <span class="co">// add y axis with ticks</span>
                    <span class="va">barChartArea</span>.<span class="at">append</span>(<span class="st">&quot;g&quot;</span>)
                        .<span class="at">attr</span>(<span class="st">&quot;class&quot;</span><span class="op">,</span> <span class="st">&quot;axis&quot;</span>)
                        .<span class="at">call</span>(<span class="va">d3</span>.<span class="at">axisLeft</span>(y).<span class="at">ticks</span>(<span class="kw">null</span><span class="op">,</span> <span class="st">&quot;s&quot;</span>))
                        .<span class="at">append</span>(<span class="st">&quot;text&quot;</span>)
                        .<span class="at">attr</span>(<span class="st">&quot;x&quot;</span><span class="op">,</span> <span class="dv">2</span>)
                        .<span class="at">attr</span>(<span class="st">&quot;y&quot;</span><span class="op">,</span> <span class="at">y</span>(<span class="va">y</span>.<span class="at">ticks</span>().<span class="at">pop</span>()) <span class="op">+</span> <span class="fl">0.5</span>)
                        .<span class="at">attr</span>(<span class="st">&quot;dy&quot;</span><span class="op">,</span> <span class="st">&quot;0.32em&quot;</span>)<span class="op">;</span>
                <span class="op">}</span>)<span class="op">;</span>
            <span class="op">}</span>
        <span class="kw">&lt;/script&gt;</span>
    <span class="kw">&lt;/body&gt;</span>
<span class="kw">&lt;/html&gt;</span></code></pre>
<p>Well, not that complicated, isn’t it.</p>
<p>Now, we leave you a job to add a legend for the colours and make it interactive!</p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="activity-basic-web-development-skills.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="activity-effective-graphic-design.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"download": ["_main.pdf"],
"toc": {
"collapse": "Module"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
