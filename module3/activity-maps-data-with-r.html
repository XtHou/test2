<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>4 Activity: Maps &amp; data with R | Module 3 Making sense of spatial data</title>
  <meta name="description" content="This is the third module in the FIT5147 Data Exploration and Visualisation unit. In this module you will learn about common graphics for showing spatial data. That is, data that is naturally associated with a geographic location or region and for which you want to explore the data taking this association into account.">
  <meta name="generator" content="bookdown  and GitBook 2.6.7">

  <meta property="og:title" content="4 Activity: Maps &amp; data with R | Module 3 Making sense of spatial data" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is the third module in the FIT5147 Data Exploration and Visualisation unit. In this module you will learn about common graphics for showing spatial data. That is, data that is naturally associated with a geographic location or region and for which you want to explore the data taking this association into account." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="4 Activity: Maps &amp; data with R | Module 3 Making sense of spatial data" />
  
  <meta name="twitter:description" content="This is the third module in the FIT5147 Data Exploration and Visualisation unit. In this module you will learn about common graphics for showing spatial data. That is, data that is naturally associated with a geographic location or region and for which you want to explore the data taking this association into account." />
  

<meta name="author" content="Kimbal Marriott">



  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="overview-of-tools-for-creating-data-maps.html">
<link rel="next" href="activity-shape-files-maps-with-r.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />










<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><strong><a href="./">Module 3 Making sense of spatial data</a></strong></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Making sense of spatial data: Overview</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#aims-of-this-module"><i class="fa fa-check"></i><b>1.1</b> Aims of this module</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#how-to-study-for-this-module"><i class="fa fa-check"></i><b>1.2</b> How to study for this module</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="how-to-design-a-data-map.html"><a href="how-to-design-a-data-map.html"><i class="fa fa-check"></i><b>2</b> How to design a data map</a><ul>
<li class="chapter" data-level="2.1" data-path="how-to-design-a-data-map.html"><a href="how-to-design-a-data-map.html#scale-and-generalisation"><i class="fa fa-check"></i><b>2.1</b> Scale and generalisation</a></li>
<li class="chapter" data-level="2.2" data-path="how-to-design-a-data-map.html"><a href="how-to-design-a-data-map.html#coordinate-system"><i class="fa fa-check"></i><b>2.2</b> Coordinate system</a></li>
<li class="chapter" data-level="2.3" data-path="how-to-design-a-data-map.html"><a href="how-to-design-a-data-map.html#map-projections"><i class="fa fa-check"></i><b>2.3</b> Map projections</a></li>
<li class="chapter" data-level="2.4" data-path="how-to-design-a-data-map.html"><a href="how-to-design-a-data-map.html#choice-of-data-map"><i class="fa fa-check"></i><b>2.4</b> Choice of data map</a><ul>
<li class="chapter" data-level="" data-path="how-to-design-a-data-map.html"><a href="how-to-design-a-data-map.html#choropleth-and-prism"><i class="fa fa-check"></i>Choropleth and prism</a></li>
<li class="chapter" data-level="" data-path="how-to-design-a-data-map.html"><a href="how-to-design-a-data-map.html#dot-density"><i class="fa fa-check"></i>Dot density</a></li>
<li class="chapter" data-level="" data-path="how-to-design-a-data-map.html"><a href="how-to-design-a-data-map.html#proportional-symbol"><i class="fa fa-check"></i>Proportional symbol</a></li>
<li class="chapter" data-level="" data-path="how-to-design-a-data-map.html"><a href="how-to-design-a-data-map.html#contour-isarithmic-three-dimensional-maps"><i class="fa fa-check"></i>Contour (isarithmic) &amp; three-dimensional maps</a></li>
<li class="chapter" data-level="" data-path="how-to-design-a-data-map.html"><a href="how-to-design-a-data-map.html#cartograms"><i class="fa fa-check"></i>Cartograms</a></li>
<li class="chapter" data-level="" data-path="how-to-design-a-data-map.html"><a href="how-to-design-a-data-map.html#flow-maps"><i class="fa fa-check"></i>Flow maps</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="how-to-design-a-data-map.html"><a href="how-to-design-a-data-map.html#choice-of-classes"><i class="fa fa-check"></i><b>2.5</b> Choice of classes</a></li>
<li class="chapter" data-level="2.6" data-path="how-to-design-a-data-map.html"><a href="how-to-design-a-data-map.html#aggregation-and-clustering"><i class="fa fa-check"></i><b>2.6</b> Aggregation and clustering</a></li>
<li class="chapter" data-level="2.7" data-path="how-to-design-a-data-map.html"><a href="how-to-design-a-data-map.html#spatial-autocorrelation"><i class="fa fa-check"></i><b>2.7</b> Spatial autocorrelation</a></li>
<li class="chapter" data-level="2.8" data-path="how-to-design-a-data-map.html"><a href="how-to-design-a-data-map.html#multivariate-visualisation"><i class="fa fa-check"></i><b>2.8</b> Multivariate visualisation</a></li>
<li class="chapter" data-level="2.9" data-path="how-to-design-a-data-map.html"><a href="how-to-design-a-data-map.html#uncertainty"><i class="fa fa-check"></i><b>2.9</b> Uncertainty</a></li>
<li class="chapter" data-level="2.10" data-path="how-to-design-a-data-map.html"><a href="how-to-design-a-data-map.html#summary"><i class="fa fa-check"></i><b>2.10</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="overview-of-tools-for-creating-data-maps.html"><a href="overview-of-tools-for-creating-data-maps.html"><i class="fa fa-check"></i><b>3</b> Overview of tools for creating data maps</a><ul>
<li class="chapter" data-level="3.1" data-path="overview-of-tools-for-creating-data-maps.html"><a href="overview-of-tools-for-creating-data-maps.html#gis"><i class="fa fa-check"></i><b>3.1</b> GIS</a></li>
<li class="chapter" data-level="3.2" data-path="overview-of-tools-for-creating-data-maps.html"><a href="overview-of-tools-for-creating-data-maps.html#gis-tools-resources"><i class="fa fa-check"></i><b>3.2</b> GIS tools &amp; resources</a></li>
<li class="chapter" data-level="3.3" data-path="overview-of-tools-for-creating-data-maps.html"><a href="overview-of-tools-for-creating-data-maps.html#gis-data-formats"><i class="fa fa-check"></i><b>3.3</b> GIS data formats</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="activity-maps-data-with-r.html"><a href="activity-maps-data-with-r.html"><i class="fa fa-check"></i><b>4</b> Activity: Maps &amp; data with R</a><ul>
<li class="chapter" data-level="4.1" data-path="activity-maps-data-with-r.html"><a href="activity-maps-data-with-r.html#spatial-visualization-with-r-aka-maps"><i class="fa fa-check"></i><b>4.1</b> Spatial Visualization with R AKA maps</a><ul>
<li class="chapter" data-level="" data-path="activity-maps-data-with-r.html"><a href="activity-maps-data-with-r.html#location-location-location"><i class="fa fa-check"></i>Location, location, location</a></li>
<li class="chapter" data-level="" data-path="activity-maps-data-with-r.html"><a href="activity-maps-data-with-r.html#latitude-longitude"><i class="fa fa-check"></i>Latitude &amp; longitude</a></li>
<li class="chapter" data-level="" data-path="activity-maps-data-with-r.html"><a href="activity-maps-data-with-r.html#google-maps"><i class="fa fa-check"></i>Google Maps</a></li>
<li class="chapter" data-level="" data-path="activity-maps-data-with-r.html"><a href="activity-maps-data-with-r.html#try-some-projections"><i class="fa fa-check"></i>Try some projections</a></li>
<li class="chapter" data-level="" data-path="activity-maps-data-with-r.html"><a href="activity-maps-data-with-r.html#x-marker-on-the-map"><i class="fa fa-check"></i>‘X’ marker on the map</a></li>
<li class="chapter" data-level="" data-path="activity-maps-data-with-r.html"><a href="activity-maps-data-with-r.html#label-the-map"><i class="fa fa-check"></i>Label the map</a></li>
<li class="chapter" data-level="" data-path="activity-maps-data-with-r.html"><a href="activity-maps-data-with-r.html#data-on-a-map-using-quick-map-plot"><i class="fa fa-check"></i>Data on a map using quick map plot</a></li>
<li class="chapter" data-level="" data-path="activity-maps-data-with-r.html"><a href="activity-maps-data-with-r.html#choropleth-map"><i class="fa fa-check"></i>Choropleth Map</a></li>
<li class="chapter" data-level="" data-path="activity-maps-data-with-r.html"><a href="activity-maps-data-with-r.html#flow-map"><i class="fa fa-check"></i>Flow Map</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="activity-shape-files-maps-with-r.html"><a href="activity-shape-files-maps-with-r.html"><i class="fa fa-check"></i><b>5</b> Activity: Shape files &amp; maps with R</a><ul>
<li class="chapter" data-level="" data-path="activity-shape-files-maps-with-r.html"><a href="activity-shape-files-maps-with-r.html#shapefiles"><i class="fa fa-check"></i>Shapefiles</a></li>
<li class="chapter" data-level="" data-path="activity-shape-files-maps-with-r.html"><a href="activity-shape-files-maps-with-r.html#lets-do-a-shape-file-on-a-map"><i class="fa fa-check"></i>Let’s do a shape file on a map</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="activity-leaflet-with-r.html"><a href="activity-leaflet-with-r.html"><i class="fa fa-check"></i><b>6</b> Activity: Leaflet with R</a><ul>
<li class="chapter" data-level="6.1" data-path="activity-leaflet-with-r.html"><a href="activity-leaflet-with-r.html#introduction"><i class="fa fa-check"></i><b>6.1</b> Introduction</a></li>
<li class="chapter" data-level="6.2" data-path="activity-leaflet-with-r.html"><a href="activity-leaflet-with-r.html#marker"><i class="fa fa-check"></i><b>6.2</b> Marker</a></li>
<li class="chapter" data-level="6.3" data-path="activity-leaflet-with-r.html"><a href="activity-leaflet-with-r.html#choropleth-map-1"><i class="fa fa-check"></i><b>6.3</b> Choropleth Map</a></li>
<li class="chapter" data-level="6.4" data-path="activity-leaflet-with-r.html"><a href="activity-leaflet-with-r.html#work-with-shiny"><i class="fa fa-check"></i><b>6.4</b> Work with Shiny</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="activity-introduction-to-mapbox.html"><a href="activity-introduction-to-mapbox.html"><i class="fa fa-check"></i><b>7</b> Activity: Introduction to Mapbox</a><ul>
<li class="chapter" data-level="7.1" data-path="activity-introduction-to-mapbox.html"><a href="activity-introduction-to-mapbox.html#what-is-mapbox"><i class="fa fa-check"></i><b>7.1</b> What is MapBox?</a></li>
<li class="chapter" data-level="7.2" data-path="activity-introduction-to-mapbox.html"><a href="activity-introduction-to-mapbox.html#what-do-i-need-to-do"><i class="fa fa-check"></i><b>7.2</b> What do I need to do?</a></li>
<li class="chapter" data-level="7.3" data-path="activity-introduction-to-mapbox.html"><a href="activity-introduction-to-mapbox.html#how-do-i-sign-up"><i class="fa fa-check"></i><b>7.3</b> How do I sign up?</a></li>
<li class="chapter" data-level="7.4" data-path="activity-introduction-to-mapbox.html"><a href="activity-introduction-to-mapbox.html#mapbox-studio-intro"><i class="fa fa-check"></i><b>7.4</b> Mapbox Studio Intro</a></li>
<li class="chapter" data-level="7.5" data-path="activity-introduction-to-mapbox.html"><a href="activity-introduction-to-mapbox.html#exercises"><i class="fa fa-check"></i><b>7.5</b> Exercises</a><ul>
<li class="chapter" data-level="" data-path="activity-introduction-to-mapbox.html"><a href="activity-introduction-to-mapbox.html#a-create-a-customized-map"><i class="fa fa-check"></i>5.1a Create a customized map</a></li>
<li class="chapter" data-level="" data-path="activity-introduction-to-mapbox.html"><a href="activity-introduction-to-mapbox.html#b-create-a-customized-map-using-cartogram"><i class="fa fa-check"></i>5.1b Create a customized map using Cartogram</a></li>
<li class="chapter" data-level="" data-path="activity-introduction-to-mapbox.html"><a href="activity-introduction-to-mapbox.html#a-work-with-your-data"><i class="fa fa-check"></i>5.2a Work with your data</a></li>
<li class="chapter" data-level="" data-path="activity-introduction-to-mapbox.html"><a href="activity-introduction-to-mapbox.html#b-add-the-data-points-to-your-custom-map"><i class="fa fa-check"></i>5.2b Add the data points to your custom map</a></li>
<li class="chapter" data-level="" data-path="activity-introduction-to-mapbox.html"><a href="activity-introduction-to-mapbox.html#c-make-your-pointers-interactive"><i class="fa fa-check"></i>5.2c Make your pointers interactive</a></li>
</ul></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Module 3 Making sense of spatial data</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="activity-maps-data-with-r" class="section level1">
<h1><span class="header-section-number">4</span> Activity: Maps &amp; data with R</h1>
<div id="spatial-visualization-with-r-aka-maps" class="section level2">
<h2><span class="header-section-number">4.1</span> Spatial Visualization with R AKA maps</h2>
<p>For a long time, R has had a relatively simple mechanism, via the maps package, for making simple outlines of maps and plotting latitude &amp; longitude <strong>points</strong> and <strong>paths</strong> on them.</p>
<p>Now there are a range of options: e.g. <code>rgdal</code>, <code>rgeos</code>, <code>rmaps</code>, <code>maptools</code>, <code>mapdata</code> (also interactive map options e.g. <code>shiny</code>, <code>D3</code>, <code>leaflet</code>).</p>
<p>We’re going to look at the following packages: <code>maps</code>, <code>ggmap</code> &amp; <code>mapproj</code> (and a bit of <code>geosphere</code>):</p>
<ul>
<li><strong>maps</strong>; <a href="https://cran.r-project.org/web/packages/maps/maps.pdf" class="uri">https://cran.r-project.org/web/packages/maps/maps.pdf</a></li>
<li><strong>ggmap</strong>; enables visualization by combining the spatial information of static maps from Google Maps, OpenStreetMap, Stamen Maps or CloudMade Maps with the layered grammar of graphics implementation of ggplot2.
<br>
Also access the Google Geocoding, Distance Matrix, and Directions APIs.(brought to you by the creator of ggplot, Hadley Wickham, see e.g. <a href="https://journal.r-project.org/archive/2013-1/kahle-wickham.pdf" class="uri">https://journal.r-project.org/archive/2013-1/kahle-wickham.pdf</a>)”Since ggplot2 is an implementation of the layered grammar of graphics… <strong><em>the coordinate system is fixed to the Mercator projection</em></strong>“<a href="http://stat405.had.co.nz/ggmap.pdf" class="uri">http://stat405.had.co.nz/ggmap.pdf</a></li>
<li><strong>mapproj</strong>; adds more projections (dozens) see:
<a href="https://cran.r-project.org/web/packages/mapproj/mapproj.pdf" class="uri">https://cran.r-project.org/web/packages/mapproj/mapproj.pdf</a></li>
</ul>
<p>Start with the map library and a map</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>( maps ) 
<span class="kw">map</span> (<span class="st">&quot;nz&quot;</span>)<span class="co"># what a cute country</span></code></pre>
<div id="location-location-location" class="section level3 unnumbered">
<h3>Location, location, location</h3>
<p>Here, we are going to introduce 3 different ways to <strong>define a location</strong> in ggmap.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(ggmap)<span class="co"># load ggmap</span>
 
<span class="co"># Define location 3 ways</span>
<span class="co"># 1. location/address</span>
myLocation1 &lt;-<span class="st"> &quot;Melbourne&quot;</span>
myLocation1
 
<span class="co"># 2. lat/long</span>
myLocation2 &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dt">lon=</span><span class="op">-</span><span class="fl">95.3632715</span>, <span class="dt">lat=</span><span class="fl">29.7632836</span>)<span class="co"># not &quot;Melbourne&quot;</span>
myLocation2
 
<span class="co"># 3. an area or bounding box (4 points), lower left lon, </span>
<span class="co"># lower left lat, upper right lon, upper right lat</span>
<span class="co"># (a little glitchy for google maps)</span>
myLocation3 &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="op">-</span><span class="dv">130</span>, <span class="dv">30</span>, <span class="dv">-105</span>, <span class="dv">50</span>)
myLocation3</code></pre>
</div>
<div id="latitude-longitude" class="section level3 unnumbered">
<h3>Latitude &amp; longitude</h3>
<p>One important geo-feature for geo-related applications is getting latitude and longitude of a given address (country, city, suburb, street and etc.).<br />
As once you have the location, you will know where to place your visualisation for this data.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Convert location/address to its lat/long coordinates:</span>
<span class="kw">geocode</span>(<span class="st">&quot;Melbourne&quot;</span>)
<span class="co"># Yes, Melbourne is where it&#39;s supposed to be in, in Australia</span>
<span class="co"># longitude 144.9633</span>
<span class="co"># latitude -37.814</span></code></pre>
<p><mark class="big">So now let’s see a map based on location. There are 4 map sources (online services), with multiple map types:</mark></p>
<ol style="list-style-type: decimal">
<li>stamen: e.g. “terrain”, “toner”, “watercolor” etc.</li>
<li>google: “roadmap”, “terrain”, “satellite”, “hybrid”</li>
<li>osm: open street map</li>
<li>cloudmade: 1000s of maps, but you need an api key</li>
</ol>
<p>In R, try:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># or help(get_stamenmap) </span>
<span class="co"># also try ?get_googlemap, ?get_openstreetmap and ?get_cloudmademap</span>
?get_stamenmap </code></pre>
<p>to see:
<img src="diagrams_datasets/section4/r-map-01-768x242.png" /></p>
<p>The <code>get_map</code> function provides a general approach for quickly obtaining maps from multiple sources.</p>
<pre class="sourceCode r"><code class="sourceCode r">myMap &lt;-<span class="st"> </span><span class="kw">get_map</span>(<span class="dt">location =</span> myLocation2, <span class="dt">source =</span> <span class="st">&quot;stamen&quot;</span>, <span class="dt">maptype =</span> <span class="st">&quot;watercolor&quot;</span>)
<span class="kw">ggmap</span>(myMap)</code></pre>
<p>If you got an error like:<br />
    Error: GeomRasterAnn was built with an incompatible version of ggproto.</p>
<p>    Please reinstall the package that provides this extension.</p>
<p>Or</p>
<p>    Error in get(“f”, environment(CoordMap$train)) : object ‘f’ not found</p>
<p>It is because there are some dependency conflicts of the lastest R and ggplot2 package.
You need to update your R packages first with (may take around 20 minutes):</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">update.packages</span>(<span class="dt">ask =</span> <span class="ot">FALSE</span>, <span class="dt">checkBuilt =</span> <span class="ot">TRUE</span>)</code></pre>
<p>After that, you need to install 2 packages:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">install.packages</span>(<span class="kw">c</span>(<span class="st">&quot;curl&quot;</span>, <span class="st">&quot;yaml&quot;</span>))</code></pre>
<p>At last, you can solve this issue by installing the github version packages by:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">install.packages</span>(<span class="st">&quot;devtools&quot;</span>) 
devtools<span class="op">::</span><span class="kw">install_github</span>(<span class="st">&quot;hadley/ggplot2@v2.2.0&quot;</span>)
devtools<span class="op">::</span><span class="kw">install_github</span>(<span class="st">&quot;dkahle/ggmap&quot;</span>)</code></pre>
<p>And then <strong>restart your RStudio</strong>, and try the code again.</p>
</div>
<div id="google-maps" class="section level3 unnumbered">
<h3>Google Maps</h3>
<p>Let’s try another different source.</p>
<pre class="sourceCode r"><code class="sourceCode r">myMap &lt;-<span class="st"> </span><span class="kw">get_map</span>(<span class="dt">location =</span> myLocation1, <span class="dt">source=</span><span class="st">&quot;google&quot;</span>, <span class="dt">color=</span><span class="st">&quot;bw&quot;</span>)
<span class="kw">ggmap</span>(myMap)</code></pre>
<p>Let’s also play with the <code>maptype</code>.</p>
<p><strong>Please note</strong>, you may also need to change the <code>“maptype”</code> parameters.</p>
<p>Different source support different map types. Use <code>?get_googlemap</code> to check.</p>
<pre class="sourceCode r"><code class="sourceCode r">myMap &lt;-<span class="st"> </span><span class="kw">get_map</span>(<span class="dt">location =</span> myLocation1, <span class="dt">source=</span><span class="st">&quot;google&quot;</span>, <span class="dt">maptype=</span><span class="st">&quot;terrain&quot;</span>, <span class="dt">zoom =</span> <span class="dv">10</span>) 
<span class="kw">ggmap</span>(myMap) </code></pre>
</div>
<div id="try-some-projections" class="section level3 unnumbered">
<h3>Try some projections</h3>
<p>mercator: equally spaced straight meridians, conformal, straight compass courses</p>
<p>then compare with e.g. albers (named after Heinrich C. Albers), is a conic, equal area map projection that uses two standard parallels
<a href="https://en.wikipedia.org/wiki/Albers_projection" class="uri">https://en.wikipedia.org/wiki/Albers_projection</a></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">require</span>(mapproj)
<span class="co"># get map data (lat &amp;amp;amp; lon for boundaries in this case)</span>
m &lt;-<span class="st"> </span><span class="kw">map</span>(<span class="st">&quot;usa&quot;</span>, <span class="dt">plot =</span> <span class="ot">FALSE</span>) 
 
<span class="kw">map</span>(m, <span class="dt">project =</span> <span class="st">&quot;mercator&quot;</span>) <span class="co"># try mercator first</span>
<span class="kw">map.grid</span>(m) <span class="co"># draw graticules</span>

<span class="co"># change the projection to albers</span>
<span class="kw">map</span>(m, <span class="dt">project =</span> <span class="st">&quot;albers&quot;</span>, <span class="dt">par=</span><span class="kw">c</span>(<span class="dv">39</span>,<span class="dv">45</span>))
<span class="kw">map.grid</span>(m) <span class="co"># draw graticules to compare more easily</span></code></pre>
<p>Let’s move on to the whole world.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># get unprojected world limits</span>
m &lt;-<span class="st"> </span><span class="kw">map</span>(<span class="st">&#39;world&#39;</span>, <span class="dt">plot =</span> <span class="ot">FALSE</span>)
<span class="co"># center on New York</span>
<span class="kw">map</span>(m, <span class="dt">proj =</span> <span class="st">&#39;azequalarea&#39;</span>, <span class="dt">orient =</span> <span class="kw">c</span>(<span class="dv">41</span>,<span class="op">-</span><span class="dv">74</span>,<span class="dv">0</span>))
<span class="kw">map.grid</span>(m, <span class="dt">col =</span> <span class="dv">2</span>) <span class="co"># draw graticules</span></code></pre>
<p>Your turn, rotate the map to show Australia (using R).</p>
</div>
<div id="x-marker-on-the-map" class="section level3 unnumbered">
<h3>‘X’ marker on the map</h3>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">map</span>(m, <span class="dt">proj =</span> <span class="st">&#39;orth&#39;</span>, <span class="dt">orient =</span> <span class="kw">c</span>(<span class="dv">41</span>,<span class="op">-</span><span class="dv">74</span>,<span class="dv">0</span>))
<span class="kw">map.grid</span>(m, <span class="dt">col =</span> <span class="dv">2</span>, <span class="dt">nx =</span> <span class="dv">6</span>, <span class="dt">ny =</span> <span class="dv">5</span>, <span class="dt">label =</span> <span class="ot">FALSE</span>, <span class="dt">lty =</span> <span class="dv">2</span>)
<span class="kw">points</span>(
  <span class="kw">mapproject</span>(
    <span class="kw">list</span>(<span class="dt">y =</span> <span class="dv">41</span>, <span class="dt">x =</span> <span class="dv">-74</span>)
  ),
  <span class="dt">col =</span> <span class="dv">3</span>,
  <span class="dt">pch =</span> <span class="st">&quot;x&quot;</span>,
  <span class="dt">cex =</span> <span class="dv">2</span>
)<span class="co"># centre on NY</span></code></pre>
<p>Your turn, centre on Melbourne.</p>
</div>
<div id="label-the-map" class="section level3 unnumbered">
<h3>Label the map</h3>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">map</span>(<span class="st">&quot;state&quot;</span>, <span class="dt">proj=</span><span class="st">&#39;bonne&#39;</span>, <span class="dt">param=</span><span class="dv">45</span>)
<span class="kw">data</span>(state)
<span class="kw">text</span>(
  <span class="kw">mapproject</span>(
    state.center
  ),
  state.abb
)</code></pre>
<p>You may also want to try:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">map</span>(<span class="st">&quot;state&quot;</span>,<span class="dt">proj=</span><span class="st">&#39;bonne&#39;</span>, <span class="dt">param=</span><span class="dv">45</span>)
<span class="kw">text</span>(
  <span class="kw">mapproject</span>(
    state.center,
    <span class="dt">proj=</span><span class="st">&#39;bonne&#39;</span>,
    <span class="dt">param=</span><span class="dv">45</span>
  ),
  state.abb
)</code></pre>
<p>However, this does not work.</p>
<p>This is because, the default <strong>orientation</strong> for <code>map</code> and <code>mapproject</code> are different.</p>
</div>
<div id="data-on-a-map-using-quick-map-plot" class="section level3 unnumbered">
<h3>Data on a map using quick map plot</h3>
<p>Let’s look at the data first. We are going to use the <code>ggmap</code> built-in data set <code>crime</code>.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">help</span>(crime)
<span class="kw">head</span>(crime)</code></pre>
<p>This data set is pretty large, here, we will choose a subset from it and plot.</p>
<pre class="sourceCode r"><code class="sourceCode r">murder &lt;-<span class="st"> </span><span class="kw">subset</span>(crime, offense <span class="op">==</span><span class="st"> &quot;murder&quot;</span>)
<span class="kw">qmplot</span>(lon, lat, 
  <span class="dt">data =</span> murder, 
  <span class="dt">colour =</span> <span class="kw">I</span>(<span class="st">&#39;red&#39;</span>),
  <span class="dt">size =</span> <span class="kw">I</span>(<span class="dv">3</span>),
  <span class="dt">darken =</span> <span class="fl">.3</span>
)</code></pre>
</div>
<div id="choropleth-map" class="section level3 unnumbered">
<h3>Choropleth Map</h3>
<p>We are going to create a choropleth map of unemployed rate of US.</p>
<p>Two data sets will be used here <code>unemp</code> and <code>county.fips</code>.</p>
<p>Data always should go first, have a look at data sets first.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">help</span>(unemp)
<span class="kw">head</span>(unemp)
 
<span class="kw">help</span>(county.fips)
<span class="kw">head</span>(county.fips)</code></pre>
<p>Let’s pre processing the data.</p>
<p>We want to split the unemployed rate into 7 intervals (“&lt;2%”,”2-4%”,”4-6%”,”6-8%”,”8-10%”,”&gt;10%”).</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># use the version installed with maps library!</span>
<span class="kw">data</span>(unemp)
 
<span class="co"># set up intervals</span>
Intervals &lt;-<span class="kw">as.numeric</span>(
  <span class="kw">cut</span>(
    unemp<span class="op">$</span>unemp,
    <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">2</span>,<span class="dv">4</span>,<span class="dv">6</span>,<span class="dv">8</span>,<span class="dv">10</span>,<span class="dv">100</span>)
  )
)</code></pre>
<p>Then we need to match unemployment data to map regions by fips codes.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(county.fips)
Matches &lt;-<span class="st"> </span>Intervals[
  <span class="kw">match</span>(
    county.fips<span class="op">$</span>fips,
    unemp<span class="op">$</span>fips
  )
]</code></pre>
<p>After that, we can prepare the color schema and plot the map.</p>
<pre class="sourceCode r"><code class="sourceCode r">colors &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;#ffffd4&quot;</span>,<span class="st">&quot;#fee391&quot;</span>,<span class="st">&quot;#fec44f&quot;</span>,<span class="st">&quot;#fe9929&quot;</span>,<span class="st">&quot;#d95f0e&quot;</span>,<span class="st">&quot;#993404&quot;</span>)
<span class="co"># draw map</span>
<span class="kw">map</span>(<span class="st">&quot;county&quot;</span>, 
  <span class="dt">col =</span> colors[Matches], 
  <span class="dt">fill =</span> <span class="ot">TRUE</span>,
  <span class="dt">resolution =</span> <span class="dv">0</span>,
  <span class="dt">lty =</span> <span class="dv">0</span>,
  <span class="dt">projection =</span> <span class="st">&quot;polyconic&quot;</span>
)</code></pre>
<p>State boundaries will make it better.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># draw state boundaries</span>
<span class="kw">map</span>(<span class="st">&quot;state&quot;</span>,
  <span class="dt">col =</span> <span class="st">&quot;purple&quot;</span>,
  <span class="dt">fill =</span> <span class="ot">FALSE</span>,
  <span class="dt">add =</span> <span class="ot">TRUE</span>,
  <span class="dt">lty =</span> <span class="dv">1</span>,
  <span class="dt">lwd =</span> <span class="fl">0.3</span>,
  <span class="dt">projection =</span> <span class="st">&quot;polyconic&quot;</span>
)</code></pre>
<p>Never forget the title and legend.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># add title and legend</span>
<span class="kw">title</span>(<span class="st">&quot;Unemployment by county, 2009&quot;</span>)
 
Legend &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;&lt;2%&quot;</span>,<span class="st">&quot;2-4%&quot;</span>,<span class="st">&quot;4-6%&quot;</span>,<span class="st">&quot;6-8%&quot;</span>,<span class="st">&quot;8-10%&quot;</span>,<span class="st">&quot;&gt;10%&quot;</span>)
<span class="kw">legend</span>(<span class="st">&quot;topright&quot;</span>, Legend, <span class="dt">horiz =</span> <span class="ot">TRUE</span>, <span class="dt">fill =</span> colors)</code></pre>
<p>Your turn!</p>
<p>Change the intervals to (“&lt;5%”,”5-10%”,”10-15%”,”15-20%”,”20-25%”,”&gt;25%”).</p>
</div>
<div id="flow-map" class="section level3 unnumbered">
<h3>Flow Map</h3>
<p>Based on <a href="http://flowingdata.com/2011/05/11/how-to-map-connections-with-great-circles/" class="uri">http://flowingdata.com/2011/05/11/how-to-map-connections-with-great-circles/</a></p>
<p>Let’s look at how to draw a line on the map.</p>
<p>Note: the shortest path between two locations is usually not <strong>a straight line</strong> on a map, because of the map projection. The shortest path is always the “great circle” that passes through the two points. This is not the same as the path travelled by a vehicle travelling on a fixed bearing which is what is shown on as a straight line using the Mercator projection.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(geosphere)
<span class="kw">map</span>(<span class="st">&quot;state&quot;</span>)
lat_ca &lt;-<span class="st"> </span><span class="fl">39.164141</span>
lon_ca &lt;-<span class="st"> </span><span class="fl">-121.640625</span>
 
lat_me &lt;-<span class="st"> </span><span class="fl">45.213004</span>
lon_me &lt;-<span class="st"> </span><span class="fl">-68.906250</span>
 
inter &lt;-<span class="st"> </span><span class="kw">gcIntermediate</span>(
  <span class="kw">c</span>(lon_ca,lat_ca),
  <span class="kw">c</span>(lon_me,lat_me),
  <span class="dt">n =</span> <span class="dv">50</span>,
  <span class="dt">addStartEnd=</span><span class="ot">TRUE</span>
)
<span class="kw">lines</span>(inter)</code></pre>
<p>Now we can draw <strong>lines</strong> of flights.</p>
<p>Again, let’s look at the data first.</p>
<pre class="sourceCode r"><code class="sourceCode r">airports &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;http://datasets.flowingdata.com/tuts/maparcs/airports.csv&quot;</span>, <span class="dt">header =</span> <span class="ot">TRUE</span>)
flights &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;http://datasets.flowingdata.com/tuts/maparcs/flights.csv&quot;</span>, <span class="dt">header =</span> <span class="ot">TRUE</span>, <span class="dt">as.is =</span> <span class="ot">TRUE</span>)
 
<span class="kw">head</span>(airports)
<span class="kw">head</span>(flights)</code></pre>
<p>Plot the map and flights.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># create a world map and limited it to around US areas.</span>
xlim &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="op">-</span><span class="fl">171.738281</span>, <span class="fl">-56.601563</span>)
ylim &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">12.039321</span>, <span class="fl">71.856229</span>)
<span class="kw">map</span>(
  <span class="st">&quot;world&quot;</span>, 
  <span class="dt">col=</span><span class="st">&quot;#f2f2f2&quot;</span>, 
  <span class="dt">fill=</span><span class="ot">TRUE</span>, 
  <span class="dt">bg=</span><span class="st">&quot;white&quot;</span>, 
  <span class="dt">lwd=</span><span class="fl">0.05</span>, 
  <span class="dt">xlim=</span>xlim, 
  <span class="dt">ylim=</span>ylim
)
 
fsub &lt;-<span class="st"> </span>flights[flights<span class="op">$</span>airline <span class="op">==</span><span class="st"> &quot;AA&quot;</span>,]
 
<span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(fsub<span class="op">$</span>airline))
{
  air1 &lt;-<span class="st"> </span>airports[
    airports<span class="op">$</span>iata <span class="op">==</span><span class="st"> </span>fsub[
      j,]<span class="op">$</span>airport1,]
   
  air2 &lt;-<span class="st"> </span>airports[
    airports<span class="op">$</span>iata <span class="op">==</span><span class="st"> </span>fsub[
      j,]<span class="op">$</span>airport2,]
   
  inter &lt;-<span class="st"> </span><span class="kw">gcIntermediate</span>(
    <span class="kw">c</span>(
      air1[<span class="dv">1</span>,]<span class="op">$</span>long,
      air1[<span class="dv">1</span>,]<span class="op">$</span>lat
    ),
    <span class="kw">c</span>(
      air2[<span class="dv">1</span>,]<span class="op">$</span>long,
      air2[<span class="dv">1</span>,]<span class="op">$</span>lat
    ),
    <span class="dt">n =</span> <span class="dv">100</span>,
    <span class="dt">addStartEnd =</span> <span class="ot">TRUE</span>
  )
   
  <span class="kw">lines</span>(inter, <span class="dt">col=</span><span class="st">&quot;black&quot;</span>, <span class="dt">lwd=</span><span class="fl">0.8</span>)
}</code></pre>
<p><strong>So what can/can’t you do with ggmap?</strong></p>
<p><strong>Compare R tools with other options, e.g. GIS tools, also Tableau Public, Google FusionTables.</strong></p>
<hr />

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="overview-of-tools-for-creating-data-maps.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="activity-shape-files-maps-with-r.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"download": ["_main.pdf"],
"toc": {
"collapse": "Module"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
