<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>6 Activity: Clustering with R | Module 2 Making sense of tabular data</title>
  <meta name="description" content="This is the second module in the FIT5147 Data Exploration and Visualisation unit. In this module you will learn about common graphics for showing tabular data. These are the kind of graphics that are common in statistics.">
  <meta name="generator" content="bookdown  and GitBook 2.6.7">

  <meta property="og:title" content="6 Activity: Clustering with R | Module 2 Making sense of tabular data" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is the second module in the FIT5147 Data Exploration and Visualisation unit. In this module you will learn about common graphics for showing tabular data. These are the kind of graphics that are common in statistics." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="6 Activity: Clustering with R | Module 2 Making sense of tabular data" />
  
  <meta name="twitter:description" content="This is the second module in the FIT5147 Data Exploration and Visualisation unit. In this module you will learn about common graphics for showing tabular data. These are the kind of graphics that are common in statistics." />
  

<meta name="author" content="Kimbal Marriott">



  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="activity-interactive-charts-with-r.html">

<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />










<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><strong><a href="./">Module 2 Making sense of tabular data</a></strong></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Making sense of tabular data: Overview</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#aims-of-this-module"><i class="fa fa-check"></i><b>1.1</b> Aims of this module</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#how-to-study-for-this-module"><i class="fa fa-check"></i><b>1.2</b> How to study for this module</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="visualising-tabular-data.html"><a href="visualising-tabular-data.html"><i class="fa fa-check"></i><b>2</b> Visualising tabular data</a><ul>
<li class="chapter" data-level="2.1" data-path="visualising-tabular-data.html"><a href="visualising-tabular-data.html#basic-statistical-graphics"><i class="fa fa-check"></i><b>2.1</b> Basic statistical graphics</a></li>
<li class="chapter" data-level="2.2" data-path="visualising-tabular-data.html"><a href="visualising-tabular-data.html#multivariate-data"><i class="fa fa-check"></i><b>2.2</b> Multivariate data</a></li>
<li class="chapter" data-level="2.3" data-path="visualising-tabular-data.html"><a href="visualising-tabular-data.html#showing-3d"><i class="fa fa-check"></i><b>2.3</b> Showing 3D</a></li>
<li class="chapter" data-level="2.4" data-path="visualising-tabular-data.html"><a href="visualising-tabular-data.html#additional-visual-attributes"><i class="fa fa-check"></i><b>2.4</b> Additional visual attributes</a></li>
<li class="chapter" data-level="2.5" data-path="visualising-tabular-data.html"><a href="visualising-tabular-data.html#multiple-charts"><i class="fa fa-check"></i><b>2.5</b> Multiple charts</a></li>
<li class="chapter" data-level="2.6" data-path="visualising-tabular-data.html"><a href="visualising-tabular-data.html#overlay-graphic-elements"><i class="fa fa-check"></i><b>2.6</b> Overlay graphic elements</a></li>
<li class="chapter" data-level="2.7" data-path="visualising-tabular-data.html"><a href="visualising-tabular-data.html#parallel-coordinates"><i class="fa fa-check"></i><b>2.7</b> Parallel coordinates</a></li>
<li class="chapter" data-level="2.8" data-path="visualising-tabular-data.html"><a href="visualising-tabular-data.html#dimension-reduction"><i class="fa fa-check"></i><b>2.8</b> Dimension reduction</a><ul>
<li class="chapter" data-level="2.8.1" data-path="visualising-tabular-data.html"><a href="visualising-tabular-data.html#multidimensional-scaling-example"><i class="fa fa-check"></i><b>2.8.1</b> Multidimensional scaling example</a></li>
</ul></li>
<li class="chapter" data-level="2.9" data-path="visualising-tabular-data.html"><a href="visualising-tabular-data.html#summary"><i class="fa fa-check"></i><b>2.9</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="analysis-of-trends-and-patterns.html"><a href="analysis-of-trends-and-patterns.html"><i class="fa fa-check"></i><b>3</b> Analysis of trends and patterns</a><ul>
<li class="chapter" data-level="3.1" data-path="analysis-of-trends-and-patterns.html"><a href="analysis-of-trends-and-patterns.html#simple-linear-regression"><i class="fa fa-check"></i><b>3.1</b> Simple linear regression</a></li>
<li class="chapter" data-level="3.2" data-path="analysis-of-trends-and-patterns.html"><a href="analysis-of-trends-and-patterns.html#checking-for-normality"><i class="fa fa-check"></i><b>3.2</b> Checking for normality</a></li>
<li class="chapter" data-level="3.3" data-path="analysis-of-trends-and-patterns.html"><a href="analysis-of-trends-and-patterns.html#data-transformation"><i class="fa fa-check"></i><b>3.3</b> Data transformation</a></li>
<li class="chapter" data-level="3.4" data-path="analysis-of-trends-and-patterns.html"><a href="analysis-of-trends-and-patterns.html#other-kinds-of-curve-fitting"><i class="fa fa-check"></i><b>3.4</b> Other kinds of curve fitting</a></li>
<li class="chapter" data-level="3.5" data-path="analysis-of-trends-and-patterns.html"><a href="analysis-of-trends-and-patterns.html#uncertainty"><i class="fa fa-check"></i><b>3.5</b> Uncertainty</a></li>
<li class="chapter" data-level="3.6" data-path="analysis-of-trends-and-patterns.html"><a href="analysis-of-trends-and-patterns.html#clustering"><i class="fa fa-check"></i><b>3.6</b> Clustering</a></li>
<li class="chapter" data-level="3.7" data-path="analysis-of-trends-and-patterns.html"><a href="analysis-of-trends-and-patterns.html#hierarchical-clustering"><i class="fa fa-check"></i><b>3.7</b> Hierarchical clustering</a></li>
<li class="chapter" data-level="3.8" data-path="analysis-of-trends-and-patterns.html"><a href="analysis-of-trends-and-patterns.html#summary-1"><i class="fa fa-check"></i><b>3.8</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="activity-advanced-plots-with-r.html"><a href="activity-advanced-plots-with-r.html"><i class="fa fa-check"></i><b>4</b> Activity: Advanced plots with R</a><ul>
<li class="chapter" data-level="4.1" data-path="activity-advanced-plots-with-r.html"><a href="activity-advanced-plots-with-r.html#introducing-ggplot2"><i class="fa fa-check"></i><b>4.1</b> Introducing ggplot2</a><ul>
<li class="chapter" data-level="4.1.1" data-path="activity-advanced-plots-with-r.html"><a href="activity-advanced-plots-with-r.html#the-philosophy"><i class="fa fa-check"></i><b>4.1.1</b> The philosophy</a></li>
<li class="chapter" data-level="4.1.2" data-path="activity-advanced-plots-with-r.html"><a href="activity-advanced-plots-with-r.html#layers"><i class="fa fa-check"></i><b>4.1.2</b> Layers</a></li>
<li class="chapter" data-level="4.1.3" data-path="activity-advanced-plots-with-r.html"><a href="activity-advanced-plots-with-r.html#aesthetics"><i class="fa fa-check"></i><b>4.1.3</b> Aesthetics</a></li>
<li class="chapter" data-level="4.1.4" data-path="activity-advanced-plots-with-r.html"><a href="activity-advanced-plots-with-r.html#geometric-objects-geoms"><i class="fa fa-check"></i><b>4.1.4</b> Geometric objects (geoms)</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="activity-advanced-plots-with-r.html"><a href="activity-advanced-plots-with-r.html#visualisation-with-ggplot2"><i class="fa fa-check"></i><b>4.2</b> visualisation with ggplot2</a><ul>
<li class="chapter" data-level="" data-path="activity-advanced-plots-with-r.html"><a href="activity-advanced-plots-with-r.html#step-1.-read-the-data"><i class="fa fa-check"></i>Step 1. read the data</a></li>
<li class="chapter" data-level="" data-path="activity-advanced-plots-with-r.html"><a href="activity-advanced-plots-with-r.html#step-2.-first-graph"><i class="fa fa-check"></i>Step 2. first graph</a></li>
<li class="chapter" data-level="" data-path="activity-advanced-plots-with-r.html"><a href="activity-advanced-plots-with-r.html#step-3.-change-the-shape"><i class="fa fa-check"></i>Step 3. change the shape</a></li>
<li class="chapter" data-level="" data-path="activity-advanced-plots-with-r.html"><a href="activity-advanced-plots-with-r.html#step-4.-change-the-color"><i class="fa fa-check"></i>Step 4. change the color</a></li>
<li class="chapter" data-level="" data-path="activity-advanced-plots-with-r.html"><a href="activity-advanced-plots-with-r.html#step-5.-facet"><i class="fa fa-check"></i>Step 5. Facet</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="activity-advanced-plots-with-r.html"><a href="activity-advanced-plots-with-r.html#starting-at-the-end"><i class="fa fa-check"></i><b>4.3</b> Starting At The End</a></li>
<li class="chapter" data-level="4.4" data-path="activity-advanced-plots-with-r.html"><a href="activity-advanced-plots-with-r.html#now-continue-with-the-basic-examples-in-the-ggplot2-cheat-sheet"><i class="fa fa-check"></i><b>4.4</b> Now continue with the basic examples in the ggplot2 ‘cheat sheet’</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="activity-interactive-charts-with-r.html"><a href="activity-interactive-charts-with-r.html"><i class="fa fa-check"></i><b>5</b> Activity: Interactive charts with R</a><ul>
<li class="chapter" data-level="5.1" data-path="activity-interactive-charts-with-r.html"><a href="activity-interactive-charts-with-r.html#shiny"><i class="fa fa-check"></i><b>5.1</b> Shiny</a><ul>
<li class="chapter" data-level="5.1.1" data-path="activity-interactive-charts-with-r.html"><a href="activity-interactive-charts-with-r.html#structure-of-a-shiny-app"><i class="fa fa-check"></i><b>5.1.1</b> Structure of a Shiny App</a></li>
<li class="chapter" data-level="5.1.2" data-path="activity-interactive-charts-with-r.html"><a href="activity-interactive-charts-with-r.html#shiny-with-ggplot"><i class="fa fa-check"></i><b>5.1.2</b> Shiny with ggplot</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="activity-interactive-charts-with-r.html"><a href="activity-interactive-charts-with-r.html#other-ways"><i class="fa fa-check"></i><b>5.2</b> Other Ways</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="activity-clustering-with-r.html"><a href="activity-clustering-with-r.html"><i class="fa fa-check"></i><b>6</b> Activity: Clustering with R</a><ul>
<li class="chapter" data-level="6.1" data-path="activity-clustering-with-r.html"><a href="activity-clustering-with-r.html#clustering-irises-data"><i class="fa fa-check"></i><b>6.1</b> Clustering “irises” data</a></li>
<li class="chapter" data-level="6.2" data-path="activity-clustering-with-r.html"><a href="activity-clustering-with-r.html#clustering-crickets-data"><i class="fa fa-check"></i><b>6.2</b> Clustering “crickets” data</a></li>
<li class="chapter" data-level="6.3" data-path="activity-clustering-with-r.html"><a href="activity-clustering-with-r.html#hierarchical-clustering-1"><i class="fa fa-check"></i><b>6.3</b> Hierarchical clustering</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Module 2 Making sense of tabular data</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="activity-clustering-with-r" class="section level1">
<h1><span class="header-section-number">6</span> Activity: Clustering with R</h1>
<p>In this Activity we look at clustering and cluster visualisation in R with the iris dataset and some cricket data.</p>
<div id="clustering-irises-data" class="section level2">
<h2><span class="header-section-number">6.1</span> Clustering “irises” data</h2>
<p>let’s look at the details of this data first.</p>
<p>Remember the <code>help()</code>?</p>
<p>This data set has the length &amp; width of <strong>Sepal</strong> and length &amp; width of <strong>Petal</strong> and the species name.</p>
<p>We are going to use visualisation to cluster the data by their <strong>Sepal</strong> and <strong>Petal</strong> information.</p>
<p>Actually these flowers (<code>irises data set</code>) are quite famous in data circles, everyone knows there are three species (but the computer doesn’t).</p>
<p>Let’s get R to classify or cluster our data.</p>
<p>First we have to remove the answer (Species), since these have already been classified…</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(ggplot2)
<span class="co"># the four measures of irises, width &amp;amp;amp; length + species</span>
<span class="kw">head</span>(iris)
<span class="co"># remove the 5th column from the dataset which contains the name of the species - </span>
<span class="co"># so there&#39;s no &#39;cheating&#39;# from this point on &#39;irises&#39; is our version of the </span>
<span class="co"># origianl &#39;iris&#39; data, so species is unknown..</span>
irises &lt;-<span class="st"> </span>iris[<span class="op">-</span><span class="dv">5</span>]
<span class="co"># and display</span>
<span class="kw">head</span>(irises)</code></pre>
<p>Now plot the data all different ways to eyeball it. This is based on</p>
<p><a href="https://cran.r-project.org/web/packages/dendextend/vignettes/Cluster_Analysis.html" class="uri">https://cran.r-project.org/web/packages/dendextend/vignettes/Cluster_Analysis.html</a></p>
<p>Let’s have a look at how the different species will look like (still cheating).</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># get the species names</span>
species_labels =<span class="st"> </span>iris[,<span class="dv">5</span>] 
<span class="co"># a library with nice colors, install it if you do not have</span>
<span class="kw">library</span>(colorspace) 
<span class="co"># get a color for each record according to its specie</span>
species_col =<span class="st"> </span><span class="kw">rev</span>(<span class="kw">rainbow_hcl</span>(<span class="dv">3</span>))[<span class="kw">as.numeric</span>(species_labels)] </code></pre>
<hr />
<p><code>rainbow_hcl(3)</code> will get 3 colors from the <code>colorspace</code> library.<br />
<code>rev</code> is reverting the vector, you can try to run the code without it and see the difference.<br />
<code>as.numeric(species_labels)</code> will change factor to numbers.<br />
<code>species_col</code> stores a color for each flower.</p>
<hr />
<p>Let’s plot something, lets try a SPLOM (Scatter plot matrix)</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">pairs</span>(irises, <span class="dt">col =</span> species_col,
      <span class="dt">lower.panel =</span> <span class="ot">NULL</span>,
      <span class="dt">cex.labels=</span><span class="dv">2</span>, <span class="dt">pch=</span><span class="dv">19</span>, <span class="dt">cex =</span> <span class="fl">1.2</span>)</code></pre>
<p>A legend will make it much better.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">par</span>(<span class="dt">xpd =</span> <span class="ot">TRUE</span>)
<span class="kw">legend</span>(<span class="dt">x =</span> <span class="fl">0.05</span>, <span class="dt">y =</span> <span class="fl">0.4</span>, <span class="dt">cex =</span> <span class="dv">2</span>,
   <span class="dt">legend =</span> <span class="kw">as.character</span>(<span class="kw">levels</span>(species_labels)),
    <span class="dt">fill =</span> <span class="kw">unique</span>(species_col))
<span class="kw">par</span>(<span class="dt">xpd =</span> <span class="ot">NA</span>)</code></pre>
<p><mark class="big"><strong>Setosa is clearly the odd one out, the other two overlap</strong></mark></p>
<p>Let’s do the real clustering (no cheating).</p>
<p>We are going to use the irises data (without the species information).</p>
<pre class="sourceCode r"><code class="sourceCode r">fit &lt;-<span class="st"> </span><span class="kw">kmeans</span>(irises, <span class="dv">3</span>, <span class="dt">nstart =</span> <span class="dv">25</span>) <span class="co"># 3 clusters, kinda cheating, try 2, or 4 (or 1)</span>
fit</code></pre>
<p>We use <code>kmeans</code> clustering algorithm to cluster the data.</p>
<p>Look into it if you want, do not forget the help().</p>
<p>In the output, the following part describes which class each record belong to.</p>
<p><img src="diagrams_datasets/section6/2.1-R-13.png" /></p>
<p>We then add this clustering information into our data.</p>
<pre class="sourceCode r"><code class="sourceCode r">df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(irises)
df<span class="op">$</span>cluster &lt;-<span class="st"> </span><span class="kw">factor</span>(fit<span class="op">$</span>cluster)</code></pre>
<p>Finally, we can plot it.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> df, <span class="kw">aes</span>(
  <span class="dt">x =</span> Sepal.Length, <span class="dt">y =</span> Petal.Length, <span class="dt">color =</span> cluster
  )) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>()</code></pre>
<p>So the clustering algorithm (kmeans) give us 3 distinct clusters (as requested), one being more separated from the other two which also have a boundary (as you’d expect, that’s what we ask for when we cluster)</p>
<p>Compare this with the original data coloured by species (colours don’t match – sorry), we can see one separate group (‘setosa’)</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> iris, <span class="kw">aes</span>(
  <span class="dt">x =</span> Sepal.Length, <span class="dt">y =</span> Petal.Length, <span class="dt">color =</span> Species)
  ) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>()</code></pre>
<p><mark class="big">Compare the two plots, how accurate is kmeans?</mark></p>
</div>
<div id="clustering-crickets-data" class="section level2">
<h2><span class="header-section-number">6.2</span> Clustering “crickets” data</h2>
<p>Try an unclassified data set, the far more famous ‘crickets’.<br />
Let’s build the data first.</p>
<pre class="sourceCode r"><code class="sourceCode r">Names =<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Mike Hussey&quot;</span>, <span class="st">&quot;Aaron Finch&quot;</span>, <span class="st">&quot;Brad Hogg&quot;</span>, <span class="st">&quot;Steve Smith&quot;</span>, 
          <span class="st">&quot;George Bailey&quot;</span>, <span class="st">&quot;Mitchell Johnson&quot;</span>, <span class="st">&quot;Shaun Marsh&quot;</span>, <span class="st">&quot;Glenn Maxwell&quot;</span>, 
          <span class="st">&quot;Pat Cummins&quot;</span>, <span class="st">&quot;Mitchell Starc&quot;</span>, <span class="st">&quot;David Warner&quot;</span>)
<span class="co"># and check length</span>
<span class="co">#length(Names)</span>
 
Ages =<span class="st"> </span><span class="kw">c</span>(<span class="dv">39</span>,<span class="dv">28</span>,<span class="dv">44</span>,<span class="dv">25</span>,<span class="dv">32</span>,<span class="dv">33</span>,<span class="dv">31</span>,<span class="dv">26</span>,<span class="dv">22</span>,<span class="dv">25</span>,<span class="dv">28</span>)
<span class="co">#length(ages)</span>
IPLSals =<span class="st"> </span><span class="kw">c</span>(<span class="dv">310</span>,<span class="dv">662</span>,<span class="dv">103</span>,<span class="dv">828</span>,<span class="dv">672</span>,<span class="dv">1340</span>,<span class="dv">455</span>,<span class="dv">1240</span>,<span class="dv">207</span>,<span class="dv">1030</span>,<span class="dv">1140</span>)</code></pre>
<p>Make a dataframe but dump names, calculating clusters using names makes no sense.</p>
<pre class="sourceCode r"><code class="sourceCode r">crickets =<span class="st"> </span><span class="kw">data.frame</span>(Names, Ages, IPLSals)
crickets <span class="co"># and display</span>
crickets =<span class="st"> </span>crickets[<span class="op">-</span><span class="dv">1</span>]</code></pre>
<p>Let’s use kmeans again for clustering.</p>
<pre class="sourceCode r"><code class="sourceCode r">clusters =<span class="st"> </span><span class="dv">2</span>  <span class="co"># how many clusters?? Don&#39;t know, try 2</span>
fit  &lt;-<span class="st"> </span><span class="kw">kmeans</span>(crickets, clusters, <span class="dt">nstart =</span> <span class="dv">25</span>)
<span class="co"># is this data even suitable for clustering, is there enough?</span>
fit
fit<span class="op">$</span>cluster
<span class="co"># df &lt;- data.frame(df)</span>
crickets<span class="op">$</span>cluster &lt;-<span class="st"> </span><span class="kw">factor</span>(fit<span class="op">$</span>cluster)</code></pre>
<p>Plot our result.</p>
<pre class="sourceCode r"><code class="sourceCode r">crickets<span class="op">$</span>cluster &lt;-<span class="st"> </span><span class="kw">factor</span>(fit<span class="op">$</span>cluster)
<span class="kw">ggplot</span>(<span class="dt">data =</span> crickets, <span class="kw">aes</span>(<span class="dt">x =</span> IPLSals, <span class="dt">y =</span> Ages, <span class="dt">color =</span> cluster)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>()</code></pre>
<p>We can also rotate it.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># rotate axes</span>
<span class="kw">ggplot</span>(<span class="dt">data =</span> crickets, <span class="kw">aes</span>(<span class="dt">y =</span> IPLSals, <span class="dt">x =</span> Ages, <span class="dt">color =</span> cluster)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>() </code></pre>
<p>Compare with the manually clustering with raw data <code>crickets</code>.</p>
</div>
<div id="hierarchical-clustering-1" class="section level2">
<h2><span class="header-section-number">6.3</span> Hierarchical clustering</h2>
<p><mark class="big">Dendrograms</mark></p>
<p>(from Greek dendro “tree” and gramma “drawing”)</p>
<p>AKA another way to cluster</p>
<p>The basic method is hclust() which includes various ‘grouping’ algorithms:</p>
<ul>
<li>“ward.D”</li>
<li>“ward.D2”</li>
<li>“single”</li>
<li>“complete”</li>
<li>“average”</li>
<li>“mcquitty”</li>
<li>“median”</li>
<li>“centroid”</li>
</ul>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># rotate axes</span>
<span class="co"># basic cluster, black &amp; white</span>
d &lt;-<span class="st"> </span><span class="kw">dist</span>(<span class="kw">as.matrix</span>(crickets))  <span class="co"># distance matrix, how close, or far apart are the data</span>
d 
<span class="co"># the distance matrix, why is there no row 1? </span>
<span class="co"># there&#39;s a big distance between 1 &amp; 6, check the data, that&#39;s the highest &amp; lowest Sal </span>
<span class="co"># what would happen if salary was scaled (up or down) e.g $1M is 1,000,000 or 1.0</span></code></pre>
<p>Let’s plot it.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># apply hierarchical clustering </span>
hcc &lt;-<span class="st"> </span><span class="kw">hclust</span>(d)
<span class="co"># and paint</span>
<span class="kw">plot</span>(hcc)                 </code></pre>
<p><strong>What does ‘Height’ mean?</strong></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(hcc, <span class="dt">labels =</span> Names) <span class="co"># use names            </span></code></pre>
<p>The four on the right are the $1M club<br />
Remember the list at the beginning, there are different clustering algorithms.<br />
Put it all together and play around them.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">2</span>))
<span class="kw">plot</span>(<span class="kw">hclust</span>(d,<span class="st">&quot;com&quot;</span>), <span class="dt">labels =</span> Names) 
<span class="kw">plot</span>(<span class="kw">hclust</span>(d,<span class="st">&quot;av&quot;</span>), <span class="dt">labels =</span> Names) 
<span class="kw">plot</span>(<span class="kw">hclust</span>(d,<span class="st">&quot;sin&quot;</span>), <span class="dt">labels =</span> Names) 
<span class="co"># you just have to try a mcquitty...</span>
<span class="kw">plot</span>(<span class="kw">hclust</span>(d,<span class="st">&quot;mcq&quot;</span>), <span class="dt">labels =</span> Names) 
<span class="co"># &quot;ward.D&quot;,</span>
<span class="co"># &quot;ward.D2&quot;,</span>
<span class="co"># &quot;mcquitty&quot; (= WPGMA),</span>
<span class="co"># &quot;median&quot; (= WPGMC) or</span>
<span class="co"># &quot;centroid&quot; (= UPGMC).</span>
 
<span class="co"># what is the default?               </span></code></pre>
<p>Colour?</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(colorspace)
<span class="kw">library</span>(dendextend)
<span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))
<span class="co"># get colors from thrid-party library</span>
cols &lt;-<span class="st"> </span><span class="kw">rainbow_hcl</span>(<span class="dv">3</span>) 
hcc &lt;-<span class="st"> </span><span class="kw">as.dendrogram</span>(hcc)
hcc &lt;-<span class="st"> </span><span class="kw">color_branches</span>(hcc, <span class="dv">3</span>)
<span class="kw">plot</span>(hcc)</code></pre>
<p>Try “large” data.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))
m_dist &lt;-<span class="st"> </span><span class="kw">dist</span>(iris, <span class="dt">diag =</span> <span class="ot">FALSE</span>)
<span class="co">#  or just &quot;com&quot;</span>
m_hclust &lt;-<span class="st"> </span><span class="kw">hclust</span>(m_dist, <span class="dt">method =</span> <span class="st">&quot;complete&quot;</span>) 
<span class="kw">plot</span>(m_hclust)</code></pre>
<p>Tree too big? Chop it up, or down, this is slow, patience</p>
<pre class="sourceCode r"><code class="sourceCode r">k =<span class="st"> </span><span class="dv">3</span>
cols &lt;-<span class="st"> </span><span class="kw">rainbow_hcl</span>(k)
dend &lt;-<span class="st"> </span><span class="kw">as.dendrogram</span>(m_hclust)
dend &lt;-<span class="st"> </span><span class="kw">color_branches</span>(dend, <span class="dt">k =</span> k)
 
<span class="kw">plot</span>(dend)
 
labels_dend &lt;-<span class="st"> </span><span class="kw">labels</span>(dend)
 
<span class="co"># cut tree to different clusters</span>
groups &lt;-<span class="st"> </span><span class="kw">cutree</span>(dend, <span class="dt">k=</span>k, <span class="dt">order_clusters_as_data =</span> <span class="ot">FALSE</span>) 
dends &lt;-<span class="st"> </span><span class="kw">list</span>()
<span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>k) {
  labels_to_keep &lt;-<span class="st"> </span>labels_dend[i <span class="op">!=</span><span class="st"> </span>groups]
  dends[[i]] &lt;-<span class="st"> </span><span class="kw">prune</span>(dend, labels_to_keep)
}
 
<span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">3</span>))
<span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>k) { 
  <span class="kw">plot</span>(dends[[i]], 
       <span class="dt">main =</span> <span class="kw">paste0</span>(<span class="st">&quot;Tree number &quot;</span>, i))
}</code></pre>
<p>Finally compare the cluster with the ‘truth’ using the real species names, as before <strong>setosa</strong> is separate</p>
<pre class="sourceCode r"><code class="sourceCode r">d_iris &lt;-<span class="st"> </span><span class="kw">dist</span>(irises) <span class="co"># method=&quot;man&quot; # is a bit better</span>
hc_iris &lt;-<span class="st"> </span><span class="kw">hclust</span>(d_iris, <span class="dt">method =</span> <span class="st">&quot;complete&quot;</span>)
iris_species &lt;-<span class="st"> </span><span class="kw">rev</span>(<span class="kw">levels</span>(iris[,<span class="dv">5</span>]))
 
<span class="kw">library</span>(dendextend)
dend &lt;-<span class="st"> </span><span class="kw">as.dendrogram</span>(hc_iris)
<span class="co"># order it the closest we can to the order of the observations:</span>
dend &lt;-<span class="st"> </span><span class="kw">rotate</span>(dend, <span class="dv">1</span><span class="op">:</span><span class="dv">150</span>)
 
<span class="co"># Color the branches based on the clusters:</span>
dend &lt;-<span class="st"> </span><span class="kw">color_branches</span>(dend, <span class="dt">k=</span><span class="dv">3</span>) <span class="co">#, groupLabels=iris_species)</span>
 
<span class="co"># Manually match the labels, as much as possible, to the real </span>
<span class="co"># classification of the flowers:</span>
<span class="kw">labels_colors</span>(dend) &lt;-
<span class="st">   </span><span class="kw">rainbow_hcl</span>(<span class="dv">3</span>)[<span class="kw">sort_levels_values</span>(
      <span class="kw">as.numeric</span>(iris[,<span class="dv">5</span>])[<span class="kw">order.dendrogram</span>(dend)]
   )]
 
<span class="co"># We shall add the flower type to the labels:</span>
<span class="kw">labels</span>(dend) &lt;-<span class="st"> </span><span class="kw">paste</span>(<span class="kw">as.character</span>(iris[,<span class="dv">5</span>])[<span class="kw">order.dendrogram</span>(dend)],
                           <span class="st">&quot;(&quot;</span>,<span class="kw">labels</span>(dend),<span class="st">&quot;)&quot;</span>, 
                           <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)
<span class="co"># We hang the dendrogram a bit:</span>
dend &lt;-<span class="st"> </span><span class="kw">hang.dendrogram</span>(dend,<span class="dt">hang_height=</span><span class="fl">0.1</span>)
<span class="co"># reduce the size of the labels:</span>
<span class="co"># dend &lt;- assign_values_to_leaves_nodePar(dend, 0.5, &quot;lab.cex&quot;)</span>
dend &lt;-<span class="st"> </span><span class="kw">set</span>(dend, <span class="st">&quot;labels_cex&quot;</span>, <span class="fl">0.5</span>)
<span class="co"># And plot:</span>
<span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))
<span class="kw">plot</span>(dend, 
     <span class="dt">main =</span> <span class="st">&quot;Clustered Iris data set</span>
<span class="st">     (the labels give the true flower species)&quot;</span>, 
     <span class="dt">horiz =</span>  <span class="ot">TRUE</span>,  <span class="dt">nodePar =</span> <span class="kw">list</span>(<span class="dt">cex =</span> <span class="fl">.007</span>))
<span class="kw">legend</span>(<span class="st">&quot;topleft&quot;</span>, <span class="dt">legend =</span> iris_species, <span class="dt">fill =</span> <span class="kw">rainbow_hcl</span>(<span class="dv">3</span>))</code></pre>
<ol start="3" style="list-style-type: decimal">
<li><a href="https://cran.r-project.org/web/packages/dendextend/vignettes/introduction.html" class="uri">https://cran.r-project.org/web/packages/dendextend/vignettes/introduction.html</a>
These visualizations demonstrate how the separation of the hierarchical clustering is very good with the “Setosa” species, but misses in labeling some “Versicolor” species as “Virginica”.</li>
</ol>
<p>The hanging of the tree also helps to locate extreme observations. For example, we can see that observation “virginica (107)” is not very similar to the Versicolor species, but still, it is among them. Also, “Versicolor (71)” is located too much “within” the group of Virginica flowers.</p>
<p>If you are interested in the implementation and differences of those clustering algorithms.</p>
<p>Have a look at this online interactive visualisation of 3 different clustering algorithms:</p>
<p><a href="https://www.alexandriarepository.org/wp-content/uploads/20160819164034/index.html" class="uri">https://www.alexandriarepository.org/wp-content/uploads/20160819164034/index.html</a></p>
<hr />

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="activity-interactive-charts-with-r.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "Module"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
